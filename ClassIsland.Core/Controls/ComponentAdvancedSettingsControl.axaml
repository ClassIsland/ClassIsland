<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:ci="http://classisland.tech/schemas/xaml/core"
             xmlns:controls="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="ClassIsland.Core.Controls.ComponentAdvancedSettingsControl">
    <UserControl.Styles>
        <Style Selector="controls|SettingsExpander.bg-settings">
            <Setter Property="IsVisible">
                <MultiBinding Converter="{x:Static BoolConverters.And}">
                    <Binding Path="$parent[ci:ComponentAdvancedSettingsControl].IsRootComponent"/>
                </MultiBinding>
            </Setter>
        </Style>
    </UserControl.Styles>
    <UserControl.Resources>
        <ci:RulesetControl x:Key="RulesetControl" Classes="in-drawer"/>
        <ci:HorizontalAlignmentToIntConverter x:Key="HorizontalAlignmentToIntConverter" />
    </UserControl.Resources>
    <ScrollViewer HorizontalAlignment="Stretch" 
                  DataContext="{Binding $parent[ci:ComponentAdvancedSettingsControl].Settings}">
        <StackPanel Classes="settings-container animated-intro" Margin="0">
            <!-- 按规则隐藏 -->
            <controls:SettingsExpander IconSource="{ci:FluentIconSource &#xEFBF;}"
                                       Header="按规则隐藏"
                                       Description="在指定规则满足时，自动隐藏此组件。注意此处的隐藏不会释放组件资源。"
                                       IsVisible="{Binding !(ci:MainWindowStylesAssist.MainWindowInEditMode)}">
                <controls:SettingsExpander.Footer>
                    <StackPanel Orientation="Horizontal">
                        <Button HorizontalAlignment="Left"
                                Theme="{StaticResource TransparentButton}"
                                Click="ButtonOpenRuleset_OnClick"
                                IsVisible="{Binding HideOnRule}">
                            <ci:IconText Glyph="&#xF17E;" Text="编辑规则集…" />
                        </Button>
                        <ToggleSwitch VerticalAlignment="Center"
                                      IsChecked="{Binding HideOnRule}" />
                    </StackPanel>
                </controls:SettingsExpander.Footer>
            </controls:SettingsExpander>
            <Separator Margin="0 12 0 4" IsVisible="{Binding !(ci:MainWindowStylesAssist.MainWindowInEditMode)}"/>
            <ci:IconText Glyph="&#xec4a;" Text="外观" Margin="0 0 0 4" />
            
            <!-- 不透明度 -->
            <controls:SettingsExpander IconSource="{ci:FluentIconSource &#xF37D;}"
                                       Header="不透明度"
                                       Description="组件整体的不透明度。">
                <controls:SettingsExpander.Footer>
                    <StackPanel Orientation="Horizontal">
                        <Slider Width="180" Minimum="0" Maximum="1"
                                Classes="auto-tooltip"
                                ci:SliderDragTooltipAssist.StringFormat="F2"
                                Value="{Binding Opacity}"
                                TickFrequency="0.05"
                                IsSnapToTickEnabled="True" />
                    </StackPanel>
                </controls:SettingsExpander.Footer>
            </controls:SettingsExpander>
            
            <!--自定义背景颜色-->
            <controls:SettingsExpander IconSource="{ci:FluentIconSource &#xE523;}"
                                       Header="自定义背景颜色"
                                       Description="当前组件背景颜色，禁用时将使用上级默认值。"
                                       Classes="bg-settings">
                <controls:SettingsExpander.Footer>
                    <StackPanel Orientation="Horizontal">
                    
                        <ColorPicker
                            VerticalAlignment="Center"
                            Margin="0 0 6 0"
                            Color="{Binding BackgroundColor, Mode=TwoWay}"
                            IsVisible="{Binding IsCustomBackgroundColorEnabled}"/>
                        <ToggleSwitch VerticalAlignment="Center"
                                      IsChecked="{Binding IsCustomBackgroundColorEnabled}" />
                    </StackPanel>
                </controls:SettingsExpander.Footer>
            </controls:SettingsExpander>
            
            <!-- 自定义背景不透明度 -->
            <controls:SettingsExpander IconSource="{ci:FluentIconSource &#xF37D;}"
                                       Header="自定义背景不透明度"
                                       Description="当前组件的背景的不透明度，禁用将使用上级默认值。"
                                       Classes="bg-settings">
                <controls:SettingsExpander.Footer>
                    <StackPanel Orientation="Horizontal">
                        <Slider Width="180" Minimum="0" Maximum="1"
                                Classes="auto-tooltip"
                                ci:SliderDragTooltipAssist.StringFormat="F2"
                                Value="{Binding BackgroundOpacity}"
                                TickFrequency="0.05"
                                IsSnapToTickEnabled="True" 
                                IsVisible="{Binding IsCustomBackgroundOpacityEnabled}"/>
                        <ToggleSwitch VerticalAlignment="Center"
                                      IsChecked="{Binding IsCustomBackgroundOpacityEnabled}" />
                    </StackPanel>
                </controls:SettingsExpander.Footer>
            </controls:SettingsExpander>
            
            <!-- 自定义背景圆角半径 -->
            <controls:SettingsExpander IconSource="{ci:FluentIconSource &#xF031;}"
                                       Header="自定义背景圆角半径"
                                       Description="当前组件背景圆角半径，调至最大数值时左右边缘为半圆。"
                                       Classes="bg-settings">
                <controls:SettingsExpander.Footer>
                    <StackPanel Orientation="Horizontal">
                        <Slider Grid.Row="0" Width="180" Minimum="0" Maximum="20"
                                Value="{Binding CustomCornerRadius}"
                                TickFrequency="0.5"
                                ci:SliderDragTooltipAssist.StringFormat="F1"
                                Classes="auto-tooltip"
                                IsSnapToTickEnabled="True"
                                VerticalAlignment="Center" 
                                IsVisible="{Binding IsCustomCornerRadiusEnabled}"/>
                        <ToggleSwitch VerticalAlignment="Center"
                                      IsChecked="{Binding IsCustomCornerRadiusEnabled}" />
                    </StackPanel>
                </controls:SettingsExpander.Footer>
            </controls:SettingsExpander>

            <Separator Margin="0 12 0 4" />
            <ci:IconText Glyph="&#xF26F;" Text="字体" Margin="0 0 0 4" />
            <!-- 字体大小 -->
            <controls:SettingsExpander IconSource="{ci:FluentIconSource &#xF273;}"
                                        Header="字体大小"
                                        Description="调整组件上各类字体的大小，将覆盖【外观】设置和主界面行中设置的字体大小。"
                                        IsExpanded="{Binding IsResourceOverridingEnabled, Mode=OneWay}">
                <controls:SettingsExpander.Footer>
                    <ToggleSwitch IsChecked="{Binding IsResourceOverridingEnabled}"/>
                </controls:SettingsExpander.Footer>
                <controls:SettingsExpander.Styles>
                    <Style Selector="ci|Field">
                        <Setter Property="Width" Value="175" />
                        <Setter Property="Suffix" Value="px" />
                        <Style Selector="^ controls|NumberBox">
                            <Setter Property="SpinButtonPlacementMode" Value="Inline" />
                            <Setter Property="Minimum" Value="1" />
                            <Setter Property="Maximum" Value="40" />
                            <Setter Property="HorizontalAlignment" Value="Stretch" />
                        </Style>
                    </Style>
                </controls:SettingsExpander.Styles>
                <controls:SettingsExpanderItem Content="次级字体大小"
                                                Description="时间点附加信息等">

                    <controls:SettingsExpanderItem.Footer>
                        <ci:Field>
                            <controls:NumberBox
                                Value="{Binding MainWindowSecondaryFontSize, Converter={x:Static ci:NotNaNConverter.Instance}}" />
                        </ci:Field>
                    </controls:SettingsExpanderItem.Footer>
                </controls:SettingsExpanderItem>
                <controls:SettingsExpanderItem Content="正文字体大小"
                                                Description="主界面默认字体大小">

                    <controls:SettingsExpanderItem.Footer>
                        <ci:Field>
                            <controls:NumberBox
                                Value="{Binding MainWindowBodyFontSize, Converter={x:Static ci:NotNaNConverter.Instance}}" />
                        </ci:Field>
                    </controls:SettingsExpanderItem.Footer>
                </controls:SettingsExpanderItem>
                <controls:SettingsExpanderItem Content="强调字体大小"
                                                Description="课程表、时钟、提醒标题、天气预报等内容">

                    <controls:SettingsExpanderItem.Footer>
                        <ci:Field>
                            <controls:NumberBox
                                Value="{Binding MainWindowEmphasizedFontSize, Converter={x:Static ci:NotNaNConverter.Instance}}" />
                        </ci:Field>
                    </controls:SettingsExpanderItem.Footer>
                </controls:SettingsExpanderItem>
                <controls:SettingsExpanderItem Content="大号字体大小"
                                                Description="课程预报等内容">

                    <controls:SettingsExpanderItem.Footer>
                        <ci:Field>
                            <controls:NumberBox
                                Value="{Binding MainWindowLargeFontSize, Converter={x:Static ci:NotNaNConverter.Instance}}" />
                        </ci:Field>
                    </controls:SettingsExpanderItem.Footer>
                </controls:SettingsExpanderItem>
            </controls:SettingsExpander>
            <!-- 字体颜色 -->
            <controls:SettingsExpander IconSource="{ci:FluentIconSource &#xF22A;}"
                                        Header="字体颜色"
                                        Description="调整字体颜色，将覆盖【外观】设置和主界面行中设置的值。">
                <controls:SettingsExpander.Footer>
                    <StackPanel Orientation="Horizontal">
                        <ColorPicker
                            VerticalAlignment="Center"
                            Margin="0 0 6 0"
                            Color="{Binding ForegroundColor, Mode=TwoWay}"
                            IsVisible="{Binding IsCustomForegroundColorEnabled}"/>
                        <ToggleSwitch VerticalAlignment="Center"
                                      IsChecked="{Binding IsCustomForegroundColorEnabled}" />
                    </StackPanel>
                </controls:SettingsExpander.Footer>
            </controls:SettingsExpander>

            <Separator Margin="0 16 0 8" />
            <ci:IconText Glyph="&#xE929;" Text="布局" Margin="0 0 0 8" />
            <!-- 对齐方式 -->
            <controls:SettingsExpander IconSource="{ci:FluentIconSource &#xE035;}"
                                       Header="对齐方式"
                                       Description="指定组件在显示容器中对齐的方式。">
                <controls:SettingsExpander.Footer>
                    <ListBox
                        AutoScrollToSelectedItem="False"
                        SelectedIndex="{Binding HorizontalAlignment, Converter={StaticResource HorizontalAlignmentToIntConverter}}">
                        <ListBox.Styles>
                            <Style Selector="ListBoxItem">
                                <Setter Property="MinWidth" Value="0"/>
                            </Style>
                        </ListBox.Styles>
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBoxItem
                            Content="{ci:FluentIcon &#xE03E;}"
                            ToolTip.Tip="拉伸" />
                        <ListBoxItem
                            Content="{ci:FluentIcon &#xE03A;}"
                            ToolTip.Tip="左对齐" />
                        <ListBoxItem
                            Content="{ci:FluentIcon &#xE034;}"
                            ToolTip.Tip="居中" />
                        <ListBoxItem
                            Content="{ci:FluentIcon &#xE03C;}"
                            ToolTip.Tip="右对齐" />
                    </ListBox>
                </controls:SettingsExpander.Footer>
            </controls:SettingsExpander>
            <!-- 固定宽度 -->
            <controls:SettingsExpander IconSource="{ci:FluentIconSource &#xEDA1;}"
                                       Header="固定宽度"
                                       Description="启用后，组件将使用固定宽度，不会自动适应内容宽度。">
                <controls:SettingsExpander.Footer>  
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <ci:Field Suffix="px" IsVisible="{Binding IsFixedWidthEnabled}">
                            <controls:NumberBox VerticalAlignment="Center"
                                     Width="150"
                                     SpinButtonPlacementMode="Inline"
                                     Value="{Binding FixedWidth, Converter={x:Static ci:NotNaNConverter.Instance}}" />
                        </ci:Field>
                        <ToggleSwitch VerticalAlignment="Center"
                                      IsChecked="{Binding IsFixedWidthEnabled}" />
                    </StackPanel>
                </controls:SettingsExpander.Footer>
            </controls:SettingsExpander>
            <!-- 宽度限制 -->
            <controls:SettingsExpander IsVisible="{Binding !IsFixedWidthEnabled}"
                                       Header="宽度限制"
                                       Description="限制控件的最大和最小宽度。"
                                       IconSource="{ci:FluentIconSource &#xEE83;}"
                                       IsExpanded="True">
                <controls:SettingsExpanderItem>
                    <controls:SettingsExpanderItem.Footer>
                        <ci:Field Suffix="px" IsVisible="{Binding IsMinWidthEnabled}">
                            <controls:NumberBox Value="{Binding MinWidth, Converter={x:Static ci:NotNaNConverter.Instance}}"
                                                SpinButtonPlacementMode="Inline"
                                                Width="150"/>
                        </ci:Field>
                    </controls:SettingsExpanderItem.Footer>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <ToggleSwitch IsChecked="{Binding IsMinWidthEnabled}"
                                      VerticalAlignment="Center"
                                      OnContent="" OffContent=""/>
                        <TextBlock Text="最小宽度" VerticalAlignment="Center"/> 
                    </StackPanel>
                </controls:SettingsExpanderItem>
                <controls:SettingsExpanderItem>
                    <controls:SettingsExpanderItem.Footer>
                        <ci:Field Suffix="px" IsVisible="{Binding IsMaxWidthEnabled}">
                            <controls:NumberBox Value="{Binding MaxWidth, Converter={x:Static ci:NotNaNConverter.Instance}}"
                                                SpinButtonPlacementMode="Inline"
                                                Width="150"/>
                        </ci:Field>
                    </controls:SettingsExpanderItem.Footer>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <ToggleSwitch IsChecked="{Binding IsMaxWidthEnabled}"
                                      VerticalAlignment="Center"
                                      OnContent="" OffContent=""/>
                        <TextBlock Text="最大宽度" VerticalAlignment="Center"/> 
                    </StackPanel>
                </controls:SettingsExpanderItem>
            </controls:SettingsExpander>
            
            <!-- 自定义边距 -->
            <controls:SettingsExpander IconSource="{ci:FluentIconSource &#xE0E1;}"
                                       Header="自定义边距"
                                       Description="设置此组件与其他组件的距离。"
                                       IsExpanded="{Binding IsCustomMarginEnabled, Mode=OneWay}">
                <controls:SettingsExpander.Footer>  
                    <ToggleSwitch VerticalAlignment="Center"
                                  IsChecked="{Binding IsCustomMarginEnabled}" />
                </controls:SettingsExpander.Footer>
                <controls:SettingsExpanderItem>
                    <Grid ColumnDefinitions="*, Auto, Auto, Auto, *"
                          RowDefinitions="*, Auto, Auto, Auto, *">
                        <Grid.Styles>
                            <Style Selector="controls|NumberBox">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="SpinButtonPlacementMode" Value="Compact"/>
                                <Setter Property="Width" Value="100"/>
                            </Style>
                        </Grid.Styles>
                        <controls:NumberBox Grid.Row="2" Grid.Column="1"
                                            Value="{Binding MarginLeft, Converter={x:Static ci:NotNaNConverter.Instance}}"/>
                        <controls:NumberBox Grid.Row="1" Grid.Column="2"
                                            Value="{Binding MarginTop, Converter={x:Static ci:NotNaNConverter.Instance}}"/>
                        <controls:NumberBox Grid.Row="2" Grid.Column="3"
                                            Value="{Binding MarginRight, Converter={x:Static ci:NotNaNConverter.Instance}}"/>
                        <controls:NumberBox Grid.Row="3" Grid.Column="2"
                                            Value="{Binding MarginBottom, Converter={x:Static ci:NotNaNConverter.Instance}}"/>
                        
                        <Rectangle Grid.Row="2" Grid.Column="2"
                                Width="100" Height="40" Margin="4"
                                Stroke="{DynamicResource ControlStrongStrokeColorDefaultBrush}"
                                StrokeThickness="1"
                                StrokeDashArray="2"
                                RadiusX="4" RadiusY="4"/>
                    </Grid>
                </controls:SettingsExpanderItem>
            </controls:SettingsExpander>
            
            <StackPanel Orientation="Horizontal" ToolTip.Tip="GUID" HorizontalAlignment="Left">
                <ci:FluentIcon Glyph="&#xE508;" VerticalAlignment="Center" />
                <SelectableTextBlock Text="{Binding Id, Mode=OneWay}"
                         Margin="4 0 0 0"
                         VerticalAlignment="Center"/>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</UserControl>
