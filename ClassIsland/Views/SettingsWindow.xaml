<controls:MyWindow x:Class="ClassIsland.Views.SettingsWindow"
                   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                   xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                   xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                   xmlns:local="clr-namespace:ClassIsland.Views"
                   xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
                   xmlns:controls="clr-namespace:ClassIsland.Controls"
                   xmlns:converters="clr-namespace:ClassIsland.Converters"
                   xmlns:models="clr-namespace:ClassIsland.Models"
                   xmlns:ci="clr-namespace:ClassIsland"
                   xmlns:cv="clr-namespace:ClassIsland.Converters"
                   xmlns:mdxaml="clr-namespace:MdXaml;assembly=MdXaml"
                   xmlns:services="clr-namespace:ClassIsland.Services"
                   xmlns:dd="urn:gong-wpf-dragdrop"
                   mc:Ignorable="d"
                   d:DataContext="{d:DesignInstance local:SettingsWindow}"
                   TextElement.Foreground="{DynamicResource MaterialDesignBody}"
                   Background="{DynamicResource MaterialDesignPaper}"
                   FontFamily="{StaticResource HarmonyOsSans}"
                   TextElement.FontWeight="Regular"
                   TextElement.FontSize="14"
                   TextOptions.TextFormattingMode="Ideal"
                   TextOptions.TextRenderingMode="Auto"
                   Title="应用设置" Height="550" Width="1200"
                   MinWidth="600"
                   Closing="SettingsWindow_OnClosing"
                   Icon="/Assets/AppLogo.ico"
                   FrameworkElement.FocusVisualStyle="{StaticResource {x:Static SystemParameters.FocusVisualStyleKey}}"
                   xmlns:mdWpf="clr-namespace:MaterialDesignThemes.Wpf;assembly=MaterialDesignThemes.Wpf"
                   xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
                   xmlns:sys="clr-namespace:System;assembly=System.Runtime"
                   xmlns:weather="clr-namespace:ClassIsland.Models.Weather"
                   xmlns:fluentWpf="clr-namespace:SourceChord.FluentWPF;assembly=FluentWPF"
                   xmlns:windows="clr-namespace:Walterlv.Windows;assembly=Walterlv"
                   xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
                   xmlns:interfaces="clr-namespace:ClassIsland.Core.Interfaces;assembly=ClassIsland.Core"
                   xmlns:notification="clr-namespace:ClassIsland.Core.Models.Notification;assembly=ClassIsland.Core">
    <Window.Resources>
        <Style TargetType="ListBoxItem" BasedOn="{StaticResource MaterialDesignListBoxItem}"
               x:Key="NotificationsListBoxItemStyle">

        </Style>
        <cv:ColorToColorPickerBrushConverter x:Key="ColorToColorPickerBrushConverter" />
        <Style TargetType="StackPanel" x:Key="SettingsPageStackPanelStyle">
            <Setter Property="Margin" Value="12" />
            <Setter Property="MaxWidth" Value="750" />
            <Style.Resources>
                <Style TargetType="controls:SettingsCard">
                    <Setter Property="Margin" Value="0 0 0 6" />
                </Style>
            </Style.Resources>
            <Style.Triggers>
                <Trigger  Property="Tag" Value="CanPolicyDisable">
                    <Setter Property="IsEnabled" Value="{Binding ManagementService.Policy.DisableSettingsEditing, Converter={StaticResource InvertBooleanConverter}}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style TargetType="ScrollViewer">
            <Setter Property="VerticalScrollBarVisibility" Value="Auto" />
            <Setter Property="materialDesign:ScrollViewerAssist.IsAutoHideEnabled" Value="True" />
            <Setter Property="PanningMode" Value="Both" />
        </Style>
        <converters:IntToStringConverter x:Key="IntToStringConverter" />
        <converters:IntToRadioButtonSelectionConverter x:Key="IntToRadioButtonSelectionConverter" />

        <Grid x:Key="OpenSourceLicense" Margin="16" Height="400" Width="550" MaxHeight="{Binding Height}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <TextBlock Grid.Row="0" Text="开放源代码许可" Style="{StaticResource MaterialDesignHeadline5TextBlock}" />
            <TextBox Grid.Row="1" Style="{StaticResource MaterialDesignOutlinedTextBox}" Margin="0 12 0 0"
                     Padding="8" Text="{Binding ViewModel.License, Mode=OneWay}" IsReadOnly="True"
                     VerticalScrollBarVisibility="Auto" FontFamily="Consolas" />
            <Button Grid.Row="2" Style="{StaticResource MaterialDesignFlatButton}" Content="确定"
                    IsDefault="True"
                    HorizontalAlignment="Right" Margin="0 8 0 0"
                    Command="{x:Static materialDesign:DialogHost.CloseDialogCommand}">

            </Button>
        </Grid>

        <Grid x:Key="DiagnosticInfoDialog" Margin="16" Height="400" Width="550" MaxHeight="{Binding Height}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <TextBlock Grid.Row="0" Text="诊断信息" Style="{StaticResource MaterialDesignHeadline5TextBlock}" />
            <TextBox Grid.Row="1" Style="{StaticResource MaterialDesignOutlinedTextBox}" Margin="0 12 0 0"
                     Padding="8" Text="{Binding ViewModel.DiagnosticInfo, Mode=OneWay}" IsReadOnly="True"
                     VerticalContentAlignment="Top"
                     VerticalScrollBarVisibility="Auto" FontFamily="Consolas" />
            <Button Grid.Row="2" Style="{StaticResource MaterialDesignFlatButton}" Content="确定"
                    IsDefault="True"
                    HorizontalAlignment="Right" Margin="0 8 0 0"
                    Command="{x:Static materialDesign:DialogHost.CloseDialogCommand}">

            </Button>
        </Grid>
        
        <StackPanel VerticalAlignment="Stretch" Margin="16" MaxWidth="400" x:Key="RestartDialog">
            <TextBlock Style="{StaticResource MaterialDesignHeadline6TextBlock}">
                <Run Text="需要重启"/>
            </TextBlock>
            <TextBlock Margin="0 6 0 0" TextWrapping="Wrap">
                <Run Text="部分设置需要重启以应用。"/>
            </TextBlock>
            <StackPanel Orientation="Horizontal" Margin="0 8 0 0" HorizontalAlignment="Right">
                <Button Content="稍后" HorizontalAlignment="Right" Style="{DynamicResource MaterialDesignFlatButton}" Command="{x:Static materialDesign:DialogHost.CloseDialogCommand}" >
                    <Button.CommandParameter>
                        <system:Boolean xmlns:system="clr-namespace:System;assembly=mscorlib">
                            False
                        </system:Boolean>
                    </Button.CommandParameter>
                </Button>
                <Button Content="立即重启" IsDefault="True" HorizontalAlignment="Right" Style="{DynamicResource MaterialDesignFlatButton}" Command="{x:Static materialDesign:DialogHost.CloseDialogCommand}" >
                    <Button.CommandParameter>
                        <system:Boolean xmlns:system="clr-namespace:System;assembly=mscorlib">
                            True
                        </system:Boolean>
                    </Button.CommandParameter>
                </Button>
            </StackPanel>
        </StackPanel>

        <StackPanel VerticalAlignment="Stretch" Margin="16" MaxWidth="400" x:Key="DebugSetTime">
            <TextBlock Style="{StaticResource MaterialDesignHeadline6TextBlock}">
                <Run Text="(debug)设置时间"/>
            </TextBlock>
            <TextBlock Margin="0 6 0 0" TextWrapping="Wrap">
                <Run Text=""/>
            </TextBlock>
            <DatePicker/>
            <materialDesign:TimePickerTextBox/>
            <StackPanel Orientation="Horizontal" Margin="0 8 0 0" HorizontalAlignment="Right">
                <Button Content="重置" HorizontalAlignment="Right" Style="{DynamicResource MaterialDesignFlatButton}" Command="{x:Static materialDesign:DialogHost.CloseDialogCommand}" >
                    <Button.CommandParameter>
                        <system:Boolean xmlns:system="clr-namespace:System;assembly=mscorlib">
                            False
                        </system:Boolean>
                    </Button.CommandParameter>
                </Button>
                <Button Content="确定" IsDefault="True" HorizontalAlignment="Right" Style="{DynamicResource MaterialDesignFlatButton}" Command="{x:Static materialDesign:DialogHost.CloseDialogCommand}" >
                    <Button.CommandParameter>
                        <system:Boolean xmlns:system="clr-namespace:System;assembly=mscorlib">
                            True
                        </system:Boolean>
                    </Button.CommandParameter>
                </Button>
            </StackPanel>
        </StackPanel>

        <!-- Drawers -->
        <ScrollViewer Width="332" x:Key="AdvancedUpdateSettings"
                      VerticalScrollBarVisibility="Auto"
                      materialDesign:ScrollViewerAssist.IsAutoHideEnabled="True">
            <Grid Margin="16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <StackPanel Grid.Row="0">
                    <TextBlock Text="更新高级设置" Style="{StaticResource MaterialDesignHeadline5TextBlock}" />
                </StackPanel>

                <StackPanel Grid.Row="1" Margin="0 16 0 0">
                    <!-- 强制更新 -->
                    <TextBlock Text="强制更新" Style="{StaticResource MaterialDesignHeadline6TextBlock}" />
                    <TextBlock Text="将应用强制更新到当前分支的最新版本，即使当前版本高于该分支的最新版本。" FontWeight="Light" TextWrapping="Wrap"
                               Margin="0 6 0 0" />
                    <Button Margin="0 3 0 0" Style="{StaticResource MaterialDesignFlatButton}"
                            HorizontalAlignment="Left"
                            Click="ButtonForceUpdate_OnClick">
                        <controls:IconText Kind="AlertOutline" Text="强制更新" />
                    </Button>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <Grid Margin="16" x:Key="ContributorsDrawer" Width="300">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition />
            </Grid.RowDefinitions>
            <TextBlock Grid.Row="0" Text="贡献人员" Style="{StaticResource MaterialDesignHeadline5TextBlock}" />
            <TextBlock Grid.Row="1" Margin="0 6 0 0" Text="感谢以下同学为本项目做出的贡献！"/>
            <Button Grid.Row="2" HorizontalAlignment="Left" 
                    Click="ButtonRefreshContributors_OnClick"
                    Margin="0 2 0 0"
                    Style="{StaticResource MaterialDesignFlatButton}"
                    materialDesign:ButtonProgressAssist.IsIndeterminate="True"
                    materialDesign:ButtonProgressAssist.IsIndicatorVisible="{Binding ViewModel.IsRefreshingContributors}"
                    IsEnabled="{Binding ViewModel.IsRefreshingContributors, Converter={StaticResource InvertBooleanConverter}}">
                <controls:IconText Kind="Refresh" Text="刷新"/>
            </Button>
            <ListView Grid.Row="3" Margin="0 2 0 0"
                      ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                      ItemsSource="{Binding Settings.ContributorsCache.Contributors}"
                      materialDesign:ListBoxItemAssist.ShowSelection="False">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Grid Grid.Column="0" VerticalAlignment="Center"
                                  Width="32" Height="32"
                                  Margin="0 0 6 0">
                                <Grid.Clip>
                                    <RectangleGeometry RadiusX="16" RadiusY="16"
                                                       Rect="0,0,32,32" />
                                </Grid.Clip>
                                <Border Background="{DynamicResource MaterialDesignBody}" Opacity="0.1" />
                                <Image Source="{Binding AvatarUri}"
                                       RenderOptions.BitmapScalingMode="HighQuality"
                                       Width="32" Height="32">
                                </Image>
                            </Grid>
                            <TextBlock Grid.Column="1" TextWrapping="Wrap">
                                <Run FontSize="15"
                                     Text="{Binding Name, Mode=OneWay}" />
                                <LineBreak />
                                <Run FontSize="11"
                                     FontWeight="Light"
                                     Text="{Binding ContributionText, Mode=OneWay}" />
                            </TextBlock>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>

        <Grid Margin="16" x:Key="ThirdPartyLibs" Width="300">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition />
            </Grid.RowDefinitions>
            <TextBlock Grid.Row="0" Text="第三方库" Style="{StaticResource MaterialDesignHeadline5TextBlock}" />
            <ListView Grid.Row="1" Margin="0 6 0 0" HorizontalContentAlignment="Stretch"
                      VirtualizingPanel.ScrollUnit="Pixel">
                <ListView.ItemTemplate>
                    <DataTemplate DataType="{x:Type models:ContributionLabel}">
                        <Grid>
                            <Grid.ToolTip>
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="License"
                                                                 Margin="0 0 3 0" />
                                        <TextBlock Text="{Binding License}"
                                                   Margin="0 0 12 0" TextWrapping="Wrap" />
                                    </StackPanel>

                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Web"
                                                                 Margin="0 0 3 0" />
                                        <TextBlock Text="{Binding Website}"
                                                   Margin="0 0 12 0" TextWrapping="Wrap" />
                                    </StackPanel>
                                </StackPanel>
                            </Grid.ToolTip>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <materialDesign:PackIcon Grid.Row="0" Grid.Column="0"
                                                     Kind="PackageVariant" VerticalAlignment="Center"
                                                     Margin="0 0 6 0" />
                            <TextBlock Grid.Row="0" Grid.Column="1"
                                       Text="{Binding Title}"
                                       VerticalAlignment="Center" FontSize="14"
                                       FontWeight="Bold" TextWrapping="Wrap" />
                            <!--<TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Description}"  Margin="0 3 0 0" TextWrapping="Wrap"/>-->
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
                <models:ContributionLabel Title="MaterialDesignInXamlToolkit"
                                          License="MIT License"
                                          Website="https://github.com/MaterialDesignInXAML/MaterialDesignInXamlToolkit/" />
                <models:ContributionLabel Title="FluentWpf"
                                          License="MIT License"
                                          Website="https://github.com/sourcechord/FluentWPF" />
                <models:ContributionLabel Title="ReoGrid"
                                          License="MIT license"
                                          Website="https://github.com/unvell/ReoGrid" />
                <models:ContributionLabel Title="EPPlus"
                                          License="Polyform Noncommercial 1.0.0"
                                          Website="https://epplussoftware.com/" />
                <models:ContributionLabel Title="Walterlv"
                                          License="&quot;Anti 996&quot; License Version 1.0"
                                          Website="https://github.com/walterlv/walterlv.demo" />
                <models:ContributionLabel Title="MahApps.Metro"
                                          License="MIT license"
                                          Website="https://github.com/MahApps/MahApps.Metro" />
                <models:ContributionLabel Title="gong-mdWpf-dragdrop"
                                          License="BSD 3-Clause"
                                          Website="https://github.com/punker76/gong-mdWpf-dragdrop" />
                <models:ContributionLabel Title="H.NotifyIcon.Wpf"
                                          License="MIT License"
                                          Website="https://github.com/HavenDV/H.NotifyIcon" />
                <models:ContributionLabel Title="MdXaml"
                                          License="MIT License"
                                          Website="https://github.com/whistyun/MdXaml" />
                <models:ContributionLabel Title="Microsoft.AppCenter"
                                          License="MIT License"
                                          Website="https://aka.ms/telgml" />
                <models:ContributionLabel Title="Downloader"
                                          License="MIT License"
                                          Website="https://github.com/bezzad/Downloader" />
                <models:ContributionLabel Title="HarmonyOS Sans" License="-"
                                          Website="https://developer.harmonyos.com/cn/design/resource" />
                <models:ContributionLabel Title="MVVM Toolkit"
                                          Website="https://github.com/CommunityToolkit/dotnet"
                                          License="MIT License" />
                <models:ContributionLabel Title="WPF" License="MIT License"
                                          Website="https://github.com/dotnet/Wpf" />
                <models:ContributionLabel Title=".NET" License="MIT License"
                                          Website="https://github.com/microsoft/dotnet" />
            </ListView>
        </Grid>

        <ScrollViewer Width="332" x:Key="ExperimentalSettings"
                      VerticalScrollBarVisibility="Auto"
                      materialDesign:ScrollViewerAssist.IsAutoHideEnabled="True">
            <StackPanel Margin="16">
                <TextBlock Text="实验性功能" Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                           Margin="0 0 0 4" />
                <TextBlock Text="正在开发/测试的不稳定功能，可能会出现Bug等问题，请谨慎使用。" TextWrapping="Wrap"
                           Margin="0 0 0 16" />
            </StackPanel>
        </ScrollViewer>

        <Grid Width="300" Margin="16" x:Key="CitySearcher">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition />
            </Grid.RowDefinitions>
            <StackPanel Grid.Row="0">
                <TextBlock Text="搜索城市" Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                           Margin="0 0 0 8" />
                <TextBox Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                         materialDesign:TextFieldAssist.HasClearButton="True"
                         TextChanged="TextBoxSearchCity_OnTextChanged"
                         materialDesign:HintAssist.Hint="搜索城市或省份…"
                         x:Name="TextBoxSearchCity"
                         IsEnabledChanged="TextBoxSearchCity_OnFocusableChanged">

                </TextBox>
            </StackPanel>
            <!-- Main list box -->
            <ListBox Grid.Row="1"
                     Margin="0 8 0 0"
                     SelectedValuePath="CityId"
                     SelectedValue="{Binding Settings.CityId}"
                     ItemsSource="{Binding ViewModel.CitySearchResults}"
                     SelectionMode="Single"
                     SelectionChanged="SelectorCity_OnSelectionChanged"
                     VirtualizingPanel.IsVirtualizing="True"
                     VirtualizingPanel.ScrollUnit="Pixel">
                <b:Interaction.Behaviors>
                    <ci:AutoScrollBehavior />
                </b:Interaction.Behaviors>
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <RadioButton Content="{Binding Name}"
                                     IsChecked="{Binding IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType=ListBoxItem}}" />
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
            <!-- 无结果 -->
            <StackPanel Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0 50">
                <StackPanel.Style>
                    <Style TargetType="StackPanel">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding ViewModel.CitySearchResults.Count}" Value="0">
                                <Setter Property="Visibility" Value="Visible" />
                            </DataTrigger>
                        </Style.Triggers>
                        <Setter Property="Visibility" Value="Collapsed" />
                    </Style>
                </StackPanel.Style>
                <materialDesign:PackIcon Kind="Search" Width="81" Height="81" HorizontalAlignment="Center" />
                <TextBlock Text="找不到符合条件的城市。请更换搜索关键字，然后再试一次。仅支持国内城市。" TextWrapping="Wrap"
                           TextAlignment="Center"
                           Margin="0 8 0 0" />
            </StackPanel>
        </Grid>

        <!-- Enabled style -->
        <Style TargetType="FrameworkElement" x:Key="UpdateEnabledStyle">
            <Style.Triggers>
                <DataTrigger Binding="{Binding UpdateService.CurrentWorkingStatus, Mode=OneWay}" Value="Idle">
                    <Setter Property="IsEnabled" Value="True" />
                </DataTrigger>
            </Style.Triggers>
            <Setter Property="IsEnabled" Value="False" />
        </Style>
        <converters:GuidToNotificationProviderConverter x:Key="GuidToNotificationProviderConverter" />
        <converters:DoubleToPercentStringConverter x:Key="DoubleToPercentStringConverter" />
        <converters:MiniInfoGuidToMiniInfoProviderMultiConverter x:Key="MiniInfoGuidToMiniInfoProviderMultiConverter" />
        <converters:SizeLongToStringConverter x:Key="SizeLongToStringConverter" />
        <CollectionViewSource Source="{Binding Settings.NotificationProvidersPriority}"
                              x:Key="CollectionViewSourceNotificationProviders"
                              Filter="CollectionViewSourceNotificationProviders_OnFilter"/>
    </Window.Resources>
    <Grid>

        <materialDesign:DialogHost Identifier="SettingsWindow">
            <materialDesign:DrawerHost RightDrawerContent="{Binding ViewModel.DrawerContent, Mode=OneWay}"
                                       DrawerClosing="MyDrawerHost_OnDrawerClosing"
                                       x:Name="MyDrawerHost">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <!-- 内容 -->
                    <TabControl Grid.Column="2" Grid.Row="1" TabStripPlacement="Left" x:Name="RootTabControl">
                        <TabControl.Resources>
                            <Style TargetType="TabItem" BasedOn="{StaticResource MaterialDesignTabItem}">
                                <Style.Triggers>
                                    
                                </Style.Triggers>
                            </Style>
                        </TabControl.Resources>
                        <!-- 基本 -->
                        <TabItem Header="基本">
                            <ScrollViewer>
                                <StackPanel Style="{StaticResource SettingsPageStackPanelStyle}" Tag="CanPolicyDisable">
                                    <controls:IconText Kind="LightningBoltOutline" Text="行为" Margin="0 0 0 8" />
                                    <!-- 开机自启 -->
                                    <controls:SettingsCard IconGlyph="AutomaticStart" Header="开机自启"
                                                           Description="在系统启动时自动运行本应用。"
                                                           IsOn="{Binding Settings.IsAutoStartEnabled, Mode=TwoWay}" />
                                    <!-- 学期开始时间 -->
                                    <controls:SettingsCard IconGlyph="CalendarOutline" Header="学期开始时间"
                                                           Description="此时间将作为学期的第一周，用于应用对单双周的计算。">
                                        <controls:SettingsCard.Switcher>
                                            <DatePicker SelectedDate="{Binding Settings.SingleWeekStartTime}"
                                                        Width="120"
                                                        Foreground="{DynamicResource MaterialDesignBody}" />
                                        </controls:SettingsCard.Switcher>
                                    </controls:SettingsCard>
                                    <!-- 隐藏窗口 -->
                                    <materialDesign:Card Margin="0 0 0 6">
                                        <Expander Background="Transparent" IsExpanded="True">
                                            <Expander.Header>
                                                <controls:SettingsControl IconGlyph="HideOutline"
                                                                          Foreground="{DynamicResource MaterialDesignBody}"
                                                                          Header="隐藏窗口" HasSwitcher="False"
                                                                          Description="将在以下选定的情况隐藏主界面，以防止影响授课。"
                                                                          Margin="-12 0" />
                                            </Expander.Header>
                                            <StackPanel Margin="36 0 64 12">
                                                <StackPanel.Resources>
                                                    <Style TargetType="CheckBox"
                                                           BasedOn="{StaticResource MaterialDesignCheckBox}">
                                                        <Setter Property="Margin" Value="0 3" />
                                                    </Style>
                                                </StackPanel.Resources>
                                                <CheckBox Content="上课时" IsChecked="{Binding Settings.HideOnClass}"
                                                          Style="{StaticResource MaterialDesignCheckBox}" />
                                                <CheckBox Content="前台是最大化窗口时"
                                                          IsChecked="{Binding Settings.HideOnMaxWindow}" />
                                                <CheckBox Content="前台是全屏窗口时"
                                                          IsChecked="{Binding Settings.HideOnFullscreen}" />
                                            </StackPanel>
                                        </Expander>
                                    </materialDesign:Card>
                                    <!-- 点击托盘图标行为 -->
                                    <controls:SettingsCard IconGlyph="CursorDefaultClickOutline"
                                                           Header="点击托盘图标行为"
                                                           Description="鼠标左键点击本应用托盘图标时应用进行的操作。无论此设置设置为什么选项，右键点击/触屏长按托盘图标仍会打开主菜单。"
                                                           IsOn="{Binding Settings.ShowExtraInfoOnTimePoint, Mode=TwoWay}">
                                        <controls:SettingsCard.Switcher>
                                            <ComboBox Foreground="{DynamicResource MaterialDesignBody}"
                                                      SelectedIndex="{Binding Settings.TaskBarIconClickBehavior}"
                                                      HorizontalContentAlignment="Left">
                                                <ComboBoxItem HorizontalContentAlignment="Left">
                                                    <controls:IconText Kind="Menu" Text="打开主菜单" />
                                                </ComboBoxItem>
                                                <ComboBoxItem HorizontalContentAlignment="Left">
                                                    <controls:IconText Kind="FileDocumentEdit" Text="打开档案编辑窗口" />
                                                </ComboBoxItem>
                                                <ComboBoxItem HorizontalContentAlignment="Left">
                                                    <controls:IconText Kind="Visibility" Text="显示/隐藏主界面" />
                                                </ComboBoxItem>
                                            </ComboBox>
                                        </controls:SettingsCard.Switcher>
                                    </controls:SettingsCard>
                                    <!-- 显示启动加载界面 -->
                                    <materialDesign:Card Margin="0 0 0 6">
                                        <Expander Background="Transparent" IsExpanded="False"
                                                  TextBlock.Foreground="{DynamicResource MaterialDesignBody}">
                                            <Expander.Header>
                                                <controls:SettingsControl IconGlyph="RocketLaunchOutline"
                                                                          Foreground="{DynamicResource MaterialDesignBody}"
                                                                          Header="显示启动加载界面"
                                                                          Description="启动时显示加载界面。"
                                                                          IsOn="{Binding Settings.IsSplashEnabled, Mode=TwoWay}"
                                                                          Margin="-12 0" />
                                            </Expander.Header>
                                            <Grid Margin="36 0 48 12">
                                                <Grid.IsEnabled>
                                                    <MultiBinding Converter="{StaticResource BooleanAndExpressionMultiConverter}">
                                                        <Binding Path="Settings.IsSplashEnabled"/>
                                                        <Binding Path="ManagementService.Policy.DisableSplashCustomize" Converter="{StaticResource InvertBooleanConverter}"/>
                                                    </MultiBinding>
                                                </Grid.IsEnabled>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>
                                                <TextBlock Grid.Row="0" Grid.Column="0" Text="自定义Logo（留空禁用）"
                                                           VerticalAlignment="Center" />
                                                <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal"
                                                            HorizontalAlignment="Right" VerticalAlignment="Center">
                                                    <TextBox MinWidth="150" MaxWidth="250"
                                                             Text="{Binding Settings.SplashCustomLogoSource}"
                                                             VerticalAlignment="Center" Margin="0 0 2 0" />
                                                    <controls:FileBrowserButton
                                                        CurrentPath="{Binding Settings.SplashCustomLogoSource, Mode=TwoWay}"
                                                        VerticalAlignment="Center" />
                                                </StackPanel>

                                                <TextBlock Grid.Row="1" Grid.Column="0" Text="自定义加载文字（留空禁用）"
                                                           VerticalAlignment="Center" Margin="0 4 0 0" />
                                                <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal"
                                                            Margin="0 4 0 0" HorizontalAlignment="Right"
                                                            VerticalAlignment="Center">
                                                    <TextBox MinWidth="200" MaxWidth="250"
                                                             Text="{Binding Settings.SplashCustomText}"
                                                             VerticalAlignment="Center" />
                                                </StackPanel>

                                                <TextBlock Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" 
                                                           Margin="0 6 0 0"
                                                           Text="自定义启动界面功能已被您的组织禁用。" Foreground="IndianRed" TextWrapping="Wrap"
                                                           Visibility="{Binding ManagementService.Policy.DisableSplashCustomize, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                            </Grid>
                                        </Expander>
                                    </materialDesign:Card>

                                    <Separator Margin="0 16 0 8" />
                                    <controls:IconText Kind="ClockOutline" Text="时钟" Margin="0 0 0 8" />
                                    <!-- 使用精确时间 -->
                                    <materialDesign:Card Margin="0 0 0 6">
                                        <Expander Background="Transparent"
                                                  IsExpanded="{Binding Settings.IsExactTimeEnabled, Mode=OneWay}"
                                                  TextBlock.Foreground="{DynamicResource MaterialDesignBody}">
                                            <Expander.Header>
                                                <controls:SettingsControl IconGlyph="TimerSyncOutline"
                                                                          Foreground="{DynamicResource MaterialDesignBody}"
                                                                          Header="使用精确时间"
                                                                          Description="启用后，ClassIsland将自动从指定的服务器上同步精确时间。此设置不影响系统时间。"
                                                                          IsOn="{Binding Settings.IsExactTimeEnabled, Mode=TwoWay}"
                                                                          Margin="-12 0" />
                                            </Expander.Header>
                                            <Grid Margin="36 0 48 12"
                                                  IsEnabled="{Binding Settings.IsExactTimeEnabled, Mode=OneWay}">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>
                                                <ComboBox VerticalAlignment="Stretch"
                                                          Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                                                          materialDesign:HintAssist.Hint="时间服务器"
                                                          Foreground="{DynamicResource MaterialDesignBody}"
                                                          Text="{Binding Settings.ExactTimeServer}"
                                                          HorizontalContentAlignment="Left"
                                                          IsEditable="True"
                                                          Margin="0 0 0 6"
                                                          Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="2">
                                                    <ComboBoxItem Content="cn.ntp.org.cn"/>
                                                    <ComboBoxItem Content="pool.ntp.org"/>
                                                    <ComboBoxItem Content="ntp.aliyun.com"/>
                                                    <ComboBoxItem Content="time.windows.com"/>
                                                </ComboBox>
                                                
                                                <TextBlock Margin="0 6 0 0" Text="{Binding ExactTimeService.SyncStatusMessage}"
                                                           TextWrapping="Wrap" Grid.Column="0" Grid.Row="2" Grid.ColumnSpan="2"/>
                                                <Button Margin="0 6 0 0" 
                                                        Grid.Column="0" Grid.Row="3" Grid.ColumnSpan="2"
                                                        HorizontalAlignment="Left"
                                                        Click="ButtonSyncTimeNow_OnClick"
                                                        Style="{StaticResource MaterialDesignFlatButton}">
                                                    <controls:IconText Kind="Refresh" Text="立即同步"/>
                                                </Button>
                                            </Grid>
                                        </Expander>
                                    </materialDesign:Card>
                                    <!-- 时间偏移 -->
                                    <materialDesign:Card Margin="0 0 0 6">
                                        <Expander Background="Transparent"
                                                  IsExpanded="True"
                                                  TextBlock.Foreground="{DynamicResource MaterialDesignBody}">
                                            <Expander.Header>
                                                <controls:SettingsControl IconGlyph="ClockArrow"
                                                                          Header="时间偏移"
                                                                          Foreground="{DynamicResource MaterialDesignBody}"
                                                                          Description="设定ClassIsland与当前时间的偏移值。如果您需要更精确地同步时间，建议您同时开启【使用精确时间】选项。"
                                                                          IsOn="{Binding Settings.IsExactTimeEnabled, Mode=TwoWay}"
                                                                          Margin="-12 0">
                                                    <controls:SettingsControl.Switcher>
                                                        <TextBox Grid.Column="1" Grid.Row="1"
                                                                 VerticalAlignment="Center"
                                                                 MinWidth="150"
                                                                 Foreground="{DynamicResource MaterialDesignBody}"
                                                                 materialDesign:TextFieldAssist.SuffixText="秒"
                                                                 Text="{Binding Settings.TimeOffsetSeconds, Converter={StaticResource IntToStringConverter}}"/>
                                                    </controls:SettingsControl.Switcher>
                                                </controls:SettingsControl>
                                            </Expander.Header>
                                            <StackPanel Margin="36 0 48 12">
                                                <!-- 自动时间偏移 -->
                                                <controls:SettingsControl IconGlyph="ClockAutoOutline" Header="自动时间偏移"
                                                                       Description="若启用，每天将自动以设定的增量值调整时间偏移量">
                                                    <controls:SettingsControl.Switcher>
                                                        <DockPanel Width="150">
                                                            <ToggleButton DockPanel.Dock="Right"
                                                                          Margin="8 0 0 0"
                                                                          IsChecked="{Binding Settings.IsTimeAutoAdjustEnabled}"/>
                                                            <TextBox Foreground="{DynamicResource MaterialDesignBody}"
                                                                     IsEnabled="{Binding Settings.IsTimeAutoAdjustEnabled}"
                                                                     Text="{Binding Settings.TimeAutoAdjustSeconds, Converter={StaticResource IntToStringConverter}}"
                                                                     materialDesign:TextFieldAssist.SuffixText="秒"/>
                                                        </DockPanel>
                                                    </controls:SettingsControl.Switcher>
                                                </controls:SettingsControl>
                                            </StackPanel>
                                        </Expander>
                                    </materialDesign:Card>
                                    <Separator Margin="0 16 0 8" />
                                    <controls:IconText Kind="WindowRestore" Text="显示" Margin="0 0 0 8" />
                                    <!-- 简略信息 -->
                                    <materialDesign:Card Margin="0 0 0 6">
                                        <Expander Background="Transparent"
                                                  IsExpanded="{Binding Settings.ShowDate, Mode=OneWay}"
                                                  TextBlock.Foreground="{DynamicResource MaterialDesignBody}">
                                            <Expander.Header>
                                                <controls:SettingsControl IconGlyph="CardTextOutline"
                                                                          Foreground="{DynamicResource MaterialDesignBody}"
                                                                          Header="快速信息"
                                                                          Description="在主界面显示特定的快速信息，以助于快速获取信息。"
                                                                          Margin="-12 0">
                                                    <controls:SettingsControl.Switcher>
                                                        <StackPanel Orientation="Horizontal">
                                                            <ComboBox Foreground="{DynamicResource MaterialDesignBody}"
                                                                      ItemsSource="{Binding MiniInfoProviderHostService.Providers}"
                                                                      SelectedValuePath="Key"
                                                                      IsEnabled="{Binding Settings.ShowDate, Mode=OneWay}"
                                                                      SelectedValue="{Binding Settings.SelectedMiniInfoProvider}"
                                                                      SelectedItem="{Binding ViewModel.SelectedMiniInfoProvider, Mode=OneWayToSource}"
                                                                      Width="100">
                                                                <ComboBox.ItemTemplate>
                                                                    <DataTemplate>
                                                                        <TextBlock Text="{Binding Value.Name}"
                                                                            ToolTip="{Binding Value.Description}" />
                                                                    </DataTemplate>
                                                                </ComboBox.ItemTemplate>
                                                            </ComboBox>
                                                            <ToggleButton
                                                                Style="{StaticResource MaterialDesignSwitchToggleButton}"
                                                                Margin="4 0 0 0"
                                                                IsChecked="{Binding Settings.ShowDate, Mode=TwoWay}">
                                                            </ToggleButton>
                                                        </StackPanel>
                                                    </controls:SettingsControl.Switcher>
                                                </controls:SettingsControl>
                                            </Expander.Header>
                                            <StackPanel IsEnabled="{Binding Settings.ShowDate, Mode=OneWay}">
                                                <StackPanel Margin="36 0 48 12"
                                                            d:DataContext="{d:DesignInstance interfaces:IMiniInfoProvider}">
                                                    <StackPanel.DataContext>
                                                        <MultiBinding
                                                            Converter="{StaticResource MiniInfoGuidToMiniInfoProviderMultiConverter}">
                                                            <Binding Path="Settings.SelectedMiniInfoProvider"
                                                                     RelativeSource="{RelativeSource FindAncestor, AncestorType=local:SettingsWindow}" />
                                                            <Binding Path="MiniInfoProviderHostService.Providers"
                                                                     RelativeSource="{RelativeSource FindAncestor, AncestorType=local:SettingsWindow}" />
                                                        </MultiBinding>
                                                    </StackPanel.DataContext>
                                                    <TextBlock Text="{Binding Description}" TextWrapping="Wrap" />
                                                    <Grid Margin="0 8 0 0">
                                                        <!-- Content -->
                                                        <ContentPresenter Content="{Binding SettingsElement}" />
                                                    </Grid>
                                                </StackPanel>
                                            </StackPanel>
                                        </Expander>
                                    </materialDesign:Card>
                                    <!-- 显示时间点附加信息 -->
                                    <materialDesign:Card Margin="0 0 0 6">
                                        <Expander Background="Transparent"
                                                  IsExpanded="{Binding Settings.ShowExtraInfoOnTimePoint, Mode=OneWay}"
                                                  TextBlock.Foreground="{DynamicResource MaterialDesignBody}">
                                            <Expander.Header>
                                                <controls:SettingsControl IconGlyph="TableSearch"
                                                                          Foreground="{DynamicResource MaterialDesignBody}"
                                                                          Header="显示时间点附加信息"
                                                                          Description="在当前的时间点上显示当前时间点的附加信息。"
                                                                          IsOn="{Binding Settings.ShowExtraInfoOnTimePoint, Mode=TwoWay}"
                                                                          Margin="-12 0" />
                                            </Expander.Header>
                                            <Grid Margin="36 0 48 12"
                                                  IsEnabled="{Binding Settings.ShowExtraInfoOnTimePoint, Mode=OneWay}">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition />
                                                </Grid.RowDefinitions>
                                                <TextBlock Grid.Column="0" Text="要显示的附加信息" VerticalAlignment="Center" />
                                                <ComboBox Grid.Row="0" Grid.Column="1"
                                                          VerticalAlignment="Center"
                                                          Foreground="{DynamicResource MaterialDesignBody}"
                                                          SelectedIndex="{Binding Settings.ExtraInfoType}"
                                                          HorizontalContentAlignment="Left">
                                                    <ComboBoxItem HorizontalContentAlignment="Left">
                                                        <TextBlock Text="时间点持续时间" />
                                                    </ComboBoxItem>
                                                    <ComboBoxItem HorizontalContentAlignment="Left">
                                                        <TextBlock Text="已过时间/持续时间" />
                                                    </ComboBoxItem>
                                                    <ComboBoxItem HorizontalContentAlignment="Left">
                                                        <TextBlock Text="剩余时间/持续时间" />
                                                    </ComboBoxItem>
                                                    <ComboBoxItem HorizontalContentAlignment="Left">
                                                        <TextBlock Text="已过时间百分比" />
                                                    </ComboBoxItem>
                                                    <ComboBoxItem HorizontalContentAlignment="Left">
                                                        <TextBlock Text="剩余时间" />
                                                    </ComboBoxItem>
                                                </ComboBox>
                                            </Grid>
                                        </Expander>
                                    </materialDesign:Card>
                                    <!-- 时间点结束倒计时 -->
                                    <materialDesign:Card Margin="0 0 0 6">
                                        <Expander Background="Transparent"
                                                  IsExpanded="{Binding Settings.IsCountdownEnabled, Mode=OneWay}"
                                                  TextBlock.Foreground="{DynamicResource MaterialDesignBody}">
                                            <Expander.Header>
                                                <controls:SettingsControl IconGlyph="ClockEnd"
                                                                          Foreground="{DynamicResource MaterialDesignBody}"
                                                                          Header="时间点结束倒计时"
                                                                          Description="在当前时间点将要结束时显示倒计时。"
                                                                          IsOn="{Binding Settings.IsCountdownEnabled, Mode=TwoWay}"
                                                                          Margin="-12 0" />
                                            </Expander.Header>
                                            <Grid Margin="36 0 48 12"
                                                  IsEnabled="{Binding Settings.IsCountdownEnabled, Mode=OneWay}">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition />
                                                </Grid.RowDefinitions>
                                                <TextBlock Grid.Column="0" Text="时间点结束倒计时时长" VerticalAlignment="Center" />
                                                <controls:NumbericTextBox MaxValue="36000" MinValue="0" Width="100"
                                                                          Grid.Column="1"
                                                                          VerticalAlignment="Center"
                                                                          materialDesign:TextFieldAssist.SuffixText="秒"
                                                                          Foreground="{DynamicResource MaterialDesignBody}"
                                                                          Style="{StaticResource MaterialDesignTextBoxBase}"
                                                                          Text="{Binding Settings.CountdownSeconds, Mode=TwoWay, Converter={StaticResource IntToStringConverter}}" />
                                            </Grid>
                                        </Expander>
                                    </materialDesign:Card>
                                    <Separator Margin="0 16 0 8" />
                                    <controls:IconText Kind="EditOutline" Text="档案编辑" Margin="0 0 0 8" />
                                    <!-- 默认上课时间点时长 -->
                                    <controls:SettingsCard IconGlyph="FileClockOutline" Header="默认上课时间点时长"
                                                           Description="在创建上课类型的时间点时默认时长。">
                                        <controls:SettingsCard.Switcher>
                                            <controls:NumbericTextBox MaxValue="36000" MinValue="0" Width="100"
                                                                      materialDesign:TextFieldAssist.SuffixText="分钟"
                                                                      Foreground="{DynamicResource MaterialDesignBody}"
                                                                      Style="{StaticResource MaterialDesignTextBox}"
                                                                      Text="{Binding Settings.DefaultOnClassTimePointMinutes, Mode=TwoWay, Converter={StaticResource IntToStringConverter}}" />
                                        </controls:SettingsCard.Switcher>
                                    </controls:SettingsCard>
                                    <!-- 默认课间时间点时长 -->
                                    <controls:SettingsCard IconGlyph="ClockOutline" Header="默认课间时间点时长"
                                                           Description="在创建课间休息类型的时间点时默认时长">
                                        <controls:SettingsCard.Switcher>
                                            <controls:NumbericTextBox MaxValue="36000" MinValue="0" Width="100"
                                                                      materialDesign:TextFieldAssist.SuffixText="分钟"
                                                                      Foreground="{DynamicResource MaterialDesignBody}"
                                                                      Style="{StaticResource MaterialDesignTextBox}"
                                                                      Text="{Binding Settings.DefaultBreakingTimePointMinutes, Mode=TwoWay, Converter={StaticResource IntToStringConverter}}" />
                                        </controls:SettingsCard.Switcher>
                                    </controls:SettingsCard>
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>

                        <!-- 外观 -->
                        <TabItem Header="外观">
                            <ScrollViewer>
                                <StackPanel Style="{StaticResource SettingsPageStackPanelStyle}" Tag="CanPolicyDisable">
                                    <controls:IconText Kind="CogOutline" Text="基本" Margin="0 0 0 8" />
                                    <!-- 界面缩放 -->
                                    <controls:SettingsCard IconGlyph="ZoomInOutline" Header="界面缩放"
                                                           Description="主界面的缩放比例。">
                                        <controls:SettingsCard.Switcher>
                                            <Slider Width="180" Minimum="0.75" Maximum="2"
                                                    VerticalAlignment="Center"
                                                    Value="{Binding Settings.Scale}"
                                                    AutoToolTipPlacement="BottomRight"
                                                    TickFrequency="0.05"
                                                    TickPlacement="None"
                                                    IsSnapToTickEnabled="True"
                                                    AutoToolTipPrecision="2" />
                                        </controls:SettingsCard.Switcher>
                                    </controls:SettingsCard>
                                    <!-- 背景透明度 -->
                                    <controls:SettingsCard IconGlyph="SquareTransparent" Header="背景不透明度"
                                                           Description="课表背景颜色的不透明度。">
                                        <controls:SettingsCard.Switcher>
                                            <Slider Width="180" Minimum="0" Maximum="1"
                                                    Value="{Binding Settings.Opacity}"
                                                    AutoToolTipPlacement="BottomRight"
                                                    TickFrequency="0.01"
                                                    IsSnapToTickEnabled="True"
                                                    AutoToolTipPrecision="2" />
                                        </controls:SettingsCard.Switcher>
                                    </controls:SettingsCard>
                                    <Separator Margin="0 16 0 8" />
                                    <controls:IconText Kind="PaletteOutline" Text="主题" Margin="0 0 0 8" />
                                    <!-- 应用主题 -->
                                    <controls:SettingsCard IconGlyph="ThemeLightDark" Header="应用主题"
                                                           Description="控制应用的明暗主题。">
                                        <controls:SettingsCard.Switcher>
                                            <ComboBox Foreground="{DynamicResource MaterialDesignBody}"
                                                      SelectedIndex="{Binding Settings.Theme}"
                                                      HorizontalContentAlignment="Left">
                                                <ComboBoxItem HorizontalContentAlignment="Left">
                                                    <controls:IconText Kind="ThemeLightDark" Text="跟随系统" />
                                                </ComboBoxItem>
                                                <ComboBoxItem HorizontalContentAlignment="Left">
                                                    <controls:IconText Kind="WhiteBalanceSunny" Text="明亮" />
                                                </ComboBoxItem>
                                                <ComboBoxItem HorizontalContentAlignment="Left">
                                                    <controls:IconText Kind="WeatherNight" Text="黑暗" />
                                                </ComboBoxItem>
                                            </ComboBox>
                                        </controls:SettingsCard.Switcher>
                                    </controls:SettingsCard>
                                    <!-- 主题色来源 -->
                                    <controls:SettingsCard IconGlyph="PaletteSwatchOutline" Header="主题色来源"
                                                           Description="控制应用选取主题色的途径。">
                                        <controls:SettingsCard.Switcher>
                                            <ComboBox Foreground="{DynamicResource MaterialDesignBody}"
                                                      HorizontalContentAlignment="Left"
                                                      SelectedIndex="{Binding Settings.ColorSource}">
                                                <ComboBoxItem HorizontalContentAlignment="Left">
                                                    <controls:IconText Kind="UserOutline" Text="自定义" />
                                                </ComboBoxItem>
                                                <ComboBoxItem HorizontalContentAlignment="Left">
                                                    <controls:IconText Kind="Wallpaper" Text="系统壁纸" />
                                                </ComboBoxItem>
                                                <ComboBoxItem HorizontalContentAlignment="Left">
                                                    <controls:IconText Kind="MicrosoftWindows" Text="系统" />
                                                </ComboBoxItem>
                                            </ComboBox>
                                        </controls:SettingsCard.Switcher>
                                    </controls:SettingsCard>
                                    <StackPanel>
                                        <StackPanel.Style>
                                            <Style TargetType="StackPanel">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Settings.ColorSource}" Value="0">
                                                        <Setter Property="Visibility" Value="Visible" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </Style>
                                        </StackPanel.Style>
                                        <!-- 第一主题色 -->
                                        <controls:SettingsCard IconGlyph="PaletteOutline" Header="第一主题色"
                                                               Description="应用主要显示的主题颜色。">
                                            <controls:SettingsCard.Switcher>
                                                <controls:ColorPicker
                                                    Color="{Binding Settings.PrimaryColor, Mode=TwoWay}" />
                                            </controls:SettingsCard.Switcher>
                                        </controls:SettingsCard>
                                        <!-- 第二主题色 -->
                                        <controls:SettingsCard IconGlyph="PaletteOutline" Header="第二主题色"
                                                               Description="应用次要显示的主题颜色。">
                                            <controls:SettingsCard.Switcher>
                                                <controls:ColorPicker
                                                    Color="{Binding Settings.SecondaryColor, Mode=TwoWay}" />
                                            </controls:SettingsCard.Switcher>
                                        </controls:SettingsCard>
                                    </StackPanel>
                                    <!-- 壁纸主题色 -->
                                    <StackPanel>
                                        <StackPanel.Style>
                                            <Style TargetType="StackPanel">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Settings.ColorSource}" Value="1">
                                                        <Setter Property="Visibility" Value="Visible" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </Style>
                                        </StackPanel.Style>
                                        <Separator Margin="0 16 0 8" />
                                        <controls:IconText Kind="Wallpaper" Text="壁纸主题色" Margin="0 0 0 8" />
                                        <!-- 壁纸主题色 -->
                                        <materialDesign:Card>
                                            <Grid>
                                                <StackPanel Margin="12">
                                                    <controls:IconText Kind="PaletteOutline" Text="选择主题色" />
                                                    <Grid VerticalAlignment="Bottom"
                                                          IsEnabled="{Binding WallpaperPickingService.IsWorking, Mode=OneWay, Converter={StaticResource BooleanToBooleanReConverter}}">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition />
                                                        </Grid.ColumnDefinitions>
                                                        <WrapPanel HorizontalAlignment="Right"
                                                                   VerticalAlignment="Center"
                                                                   Grid.Column="1">
                                                            <!-- 刷新 -->
                                                            <Button Style="{StaticResource MaterialDesignFlatButton}"
                                                                    Click="ButtonUpdateWallpaper_OnClick"
                                                                    VerticalAlignment="Center"
                                                                    Margin="2 0">
                                                                <controls:IconText Kind="Refresh" Text="刷新" />
                                                            </Button>
                                                            <!-- 预览提取结果 -->
                                                            <Button Style="{StaticResource MaterialDesignFlatButton}"
                                                                    Click="ButtonPreviewWallpaper_OnClick"
                                                                    VerticalAlignment="Center"
                                                                    Margin="2 0">
                                                                <controls:IconText Kind="EyeOutline" Text="预览提取结果" />
                                                            </Button>
                                                        </WrapPanel>
                                                        <!-- 颜色选择 -->
                                                        <ListBox Grid.Column="0"
                                                                 ItemsSource="{Binding Settings.WallpaperColorPlatte, Mode=OneWay}"
                                                                 SelectedIndex="{Binding Settings.SelectedPlatteIndex}"
                                                                 PreviewMouseWheel="UIElement_OnPreviewMouseWheel"
                                                                 HorizontalAlignment="Left">
                                                            <ListBox.ItemsPanel>
                                                                <ItemsPanelTemplate>
                                                                    <WrapPanel IsItemsHost="True" />
                                                                </ItemsPanelTemplate>
                                                            </ListBox.ItemsPanel>
                                                            <ListBox.ItemTemplate>
                                                                <DataTemplate>
                                                                    <materialDesign:ColorZone
                                                                        Background="{Binding Converter={StaticResource ColorToColorPickerBrushConverter}}"
                                                                        Width="32" Height="32"
                                                                        Mode="Custom">
                                                                        <materialDesign:PackIcon Kind="Check"
                                                                            VerticalAlignment="Bottom"
                                                                            HorizontalAlignment="Right"
                                                                            Width="14" Height="14"
                                                                            Background="White"
                                                                            Foreground="Black"
                                                                            Visibility="{Binding IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBoxItem}}, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                                                    </materialDesign:ColorZone>
                                                                </DataTemplate>
                                                            </ListBox.ItemTemplate>
                                                        </ListBox>
                                                    </Grid>
                                                </StackPanel>
                                                <ProgressBar
                                                    Visibility="{Binding WallpaperPickingService.IsWorking, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                    IsIndeterminate="True"
                                                    VerticalAlignment="Top" />
                                            </Grid>
                                        </materialDesign:Card>
                                        <!-- 启用自动提取主题色 -->
                                        <materialDesign:Card Margin="0 6 0 6">
                                            <Expander Background="Transparent"
                                                      IsExpanded="{Binding Settings.IsWallpaperAutoUpdateEnabled, Mode=OneWay}"
                                                      TextBlock.Foreground="{DynamicResource MaterialDesignBody}">
                                                <Expander.Header>
                                                    <controls:SettingsControl IconGlyph="RefreshAuto"
                                                                              Foreground="{DynamicResource MaterialDesignBody}"
                                                                              Header="启用自动提取主题色"
                                                                              Description="若启用，将会在每分钟刷新一次壁纸主题色，适用于会随时间大幅变化主题色的动态壁纸。"
                                                                              IsOn="{Binding Settings.IsWallpaperAutoUpdateEnabled, Mode=TwoWay}"
                                                                              Margin="-12 0" />
                                                </Expander.Header>
                                                <Grid Margin="36 0 48 12"
                                                      IsEnabled="{Binding Settings.IsWallpaperAutoUpdateEnabled, Mode=OneWay}">
                                                    <!-- 自动提取主题色间隔 -->
                                                    <controls:SettingsControl IconGlyph="ClockOutline"
                                                                              Header="自动提取主题色间隔"
                                                                              Description="自动从壁纸提取主题色时间隔的时间，建议以动态壁纸更新速度按需设置，不宜低于10秒。">
                                                        <controls:SettingsControl.Switcher>
                                                            <controls:NumbericTextBox MaxValue="36000" MinValue="0"
                                                                Width="150"
                                                                materialDesign:TextFieldAssist.SuffixText="秒"
                                                                Foreground="{DynamicResource MaterialDesignBody}"
                                                                Style="{StaticResource MaterialDesignTextBox}"
                                                                Text="{Binding Settings.WallpaperAutoUpdateIntervalSeconds, Mode=TwoWay, Converter={StaticResource IntToStringConverter}}" />
                                                        </controls:SettingsControl.Switcher>
                                                    </controls:SettingsControl>
                                                </Grid>
                                            </Expander>
                                        </materialDesign:Card>

                                        <!-- 兼容模式 -->
                                        <controls:SettingsCard IconGlyph="CogOutline" Header="启用兼容模式"
                                                               Description="若启用，将从注册表提取壁纸，而非桌面句柄，不兼容动态壁纸。可能可以解决一些壁纸提取中的玄学问题。"
                                                               IsOn="{Binding Settings.IsFallbackModeEnabled, Mode=TwoWay}" />
                                        <!-- 壁纸层窗口类名 -->
                                        <controls:SettingsCard IconGlyph="WindowMaximize" Header="壁纸层窗口类名"
                                                               Visibility="{Binding Settings.IsFallbackModeEnabled, Mode=OneWay, Converter={StaticResource InverseBoolToVisConverter}}"
                                                               Description="获取壁纸时要寻找的壁纸窗口的类名，留空将使用默认类名Progman。当需要从动态壁纸软件（如Wallpaper Engine等）获取壁纸时，请修改此选项为对应壁纸软件的壁纸窗口类名，以正确获取壁纸。若此栏未填写正确，将无法正常获取壁纸。">
                                            <controls:SettingsCard.Switcher>
                                                <DockPanel Width="150">
                                                    <Button Style="{StaticResource MaterialDesignFlatButton}"
                                                            Content="{materialDesign:PackIcon WindowMaximize}"
                                                            ToolTip="浏览…"
                                                            DockPanel.Dock="Right"
                                                            Click="ButtonBrowseWindows_OnClick" />
                                                    <TextBox Foreground="{DynamicResource MaterialDesignBody}"
                                                             Text="{Binding Settings.WallpaperClassName}" />
                                                </DockPanel>
                                            </controls:SettingsCard.Switcher>
                                        </controls:SettingsCard>
                                        <!-- 取色亮度波峰 -->
                                        <controls:SettingsCard IconGlyph="ChartBellCurve" Header="取色亮度波峰"
                                                               Description="取色时为亮度更接近此值的颜色赋予更高的权重，修改此值会影响到取色结果中整体颜色的亮度和准确性，请谨慎修改。（默认值：0.6）">
                                            <controls:SettingsCard.Switcher>
                                                <controls:NumbericTextBox MaxValue="1" MinValue="0" Width="150"
                                                                          Foreground="{DynamicResource MaterialDesignBody}"
                                                                          Style="{StaticResource MaterialDesignTextBox}"
                                                                          Text="{Binding Settings.TargetLightValue, Mode=TwoWay, Converter={StaticResource IntToStringConverter}}" />
                                            </controls:SettingsCard.Switcher>
                                        </controls:SettingsCard>
                                    </StackPanel>
                                    <Separator Margin="0 16 0 8" />
                                    <controls:IconText Kind="FormatFont" Text="字体" Margin="0 0 0 8" />
                                    <!-- 自定义字体 -->
                                    <controls:SettingsCard IconGlyph="FormatFont" Header="自定义字体"
                                                           Description="自定义主界面显示课表的字体。">
                                        <controls:SettingsCard.Switcher>
                                            <ComboBox ItemsSource="{Binding ViewModel.FontFamilies}"
                                                      Foreground="{DynamicResource MaterialDesignBody}"
                                                      SelectedItem="{Binding Settings.MainWindowFont, Converter={StaticResource StringToFontFamilyConverter}}">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock FontFamily="{Binding}" FontWeight="Normal"
                                                                   ToolTip="{Binding Source}">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Source}"
                                                                            Value="/ClassIsland;component/Assets/Fonts/#HarmonyOS Sans SC">
                                                                            <Setter Property="Text"
                                                                                Value="（默认）HarmonyOS Sans SC" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                    <Setter Property="Text" Value="{Binding Source}" />
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>
                                        </controls:SettingsCard.Switcher>
                                    </controls:SettingsCard>
                                    <controls:SettingsCard IconGlyph="FormatLineWeight" Header="自定义字重"
                                                           Description="自定义主界面显示的字体的字重，需要对应字体支持。">
                                        <controls:SettingsCard.Switcher>
                                            <ComboBox
                                                SelectedItem="{Binding Settings.MainWindowFontWeight2, Converter={StaticResource IntToFontWeightConverter}}"
                                                Foreground="{DynamicResource MaterialDesignBody}">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding}" FontWeight="{Binding}"
                                                                   ToolTip="{Binding}" />
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                                <x:Static Member="FontWeights.Thin" />
                                                <!--<x:Static Member="FontWeights.UltraLight"/>-->
                                                <x:Static Member="FontWeights.ExtraLight" />
                                                <x:Static Member="FontWeights.Light" />
                                                <x:Static Member="FontWeights.Normal" />
                                                <!--<x:Static Member="FontWeights.Regular"/>-->
                                                <x:Static Member="FontWeights.Medium" />
                                                <!--<x:Static Member="FontWeights.DemiBold"/>-->
                                                <x:Static Member="FontWeights.SemiBold" />
                                                <x:Static Member="FontWeights.Bold" />
                                                <x:Static Member="FontWeights.ExtraBold" />
                                                <!--<x:Static Member="FontWeights.UltraBold"/>-->
                                                <x:Static Member="FontWeights.Black" />
                                                <!--<x:Static Member="FontWeights.Heavy"/>-->
                                                <x:Static Member="FontWeights.ExtraBlack" />
                                                <!--<x:Static Member="FontWeights.UltraBlack"/>-->
                                            </ComboBox>
                                        </controls:SettingsCard.Switcher>
                                    </controls:SettingsCard>
                                    <!-- 字体预览 -->
                                    <TextBox Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             FontWeight="{Binding Settings.MainWindowFontWeight2, Converter={StaticResource IntToFontWeightConverter}}"
                                             materialDesign:HintAssist.Hint="字体预览"
                                             FontSize="17"
                                             Padding="8"
                                             IsReadOnly="False"
                                             AcceptsReturn="True"
                                             FontFamily="{Binding Settings.MainWindowFont, Mode=OneWay}"
                                             Margin="0 4 0 0"
                                             TextAlignment="Center"
                                             xml:space="preserve">送给你纯白色的花 塞西莉亚 塞西莉亚
盛开在起风的地方 沐浴九月的骄阳
语文 数学 英语 历史 物理 政治 化学 生物 地理
The quick brown fox jumps over a lazy dog.
1234567890 +-*/:</TextBox>
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>

                        <!-- 提醒 -->
                        <TabItem Header="提醒">
                            <controls:ListDetailView Margin="12"
                                                     ShowTitleWhenNotCompressed="True"
                                                     IsEnabled="{Binding ManagementService.Policy.DisableSettingsEditing, Converter={StaticResource InvertBooleanConverter}}"
                                                     IsPanelOpened="{Binding ViewModel.IsNotificationSettingsPanelOpened, Mode=TwoWay}">
                                <controls:ListDetailView.TitleElement>
                                    <Grid>
                                        <Grid
                                            DataContext="{Binding ViewModel.NotificationSettingsSelectedProvider, Converter={StaticResource GuidToNotificationProviderConverter}, Mode=OneWay}"
                                            d:DataContext="{d:DesignInstance notification:NotificationProviderRegisterInfo}">
                                            <TextBlock Text="{Binding Name}"
                                                       Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                                                       TextTrimming="CharacterEllipsis"
                                                       VerticalAlignment="Center" />
                                        </Grid>
                                    </Grid>
                                </controls:ListDetailView.TitleElement>
                                <controls:ListDetailView.LeftContent>
                                    <!-- 提醒提供方 -->
                                    <Grid Margin="0 0 4 0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        <!-- 提醒开关 -->
                                        <controls:SettingsCard Grid.Row="0" IconGlyph="BellNotificationOutline"
                                                                   Margin="0 0 0 6"
                                                                   Header="启用提醒"
                                                                   IsOn="{Binding Settings.IsNotificationEnabled, Mode=TwoWay}"
                                                                   Description="启用提醒后，将会在对重要事件发出醒目提醒。拖动提醒提供方以调整对应类型提醒的优先级。" />
                                        <!-- 提醒提供方列表 -->
                                        <TabControl Grid.Row="1">
                                            <TabItem Header="提醒提供方">
                                                <ListBox ItemsSource="{Binding Source={StaticResource CollectionViewSourceNotificationProviders}}"
                                                         SelectionMode="Single"
                                                         dd:DragDrop.IsDragSource="True"
                                                         dd:DragDrop.IsDropTarget="True"
                                                         SelectionChanged="Selector_OnSelected"
                                                         HorizontalContentAlignment="Stretch"
                                                         dd:DragDrop.DropTargetAdornerBrush="{DynamicResource PrimaryHueMidBrush}"
                                                         SelectedItem="{Binding ViewModel.NotificationSettingsSelectedProvider, Mode=TwoWay}"
                                                         ItemContainerStyle="{StaticResource NotificationsListBoxItemStyle}"
                                                         Style="{StaticResource MaterialDesignNavigationPrimaryListBox}">
                                                    <ListBox.ItemTemplate>
                                                        <DataTemplate>
                                                            <Grid
                                                                    DataContext="{Binding Converter={StaticResource GuidToNotificationProviderConverter}}"
                                                                    d:DataContext="{d:DesignInstance notification:NotificationProviderRegisterInfo}"
                                                                    Background="Transparent">
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition />
                                                                    <RowDefinition />
                                                                </Grid.RowDefinitions>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto" />
                                                                    <ColumnDefinition />
                                                                </Grid.ColumnDefinitions>

                                                                <!-- 图标 -->
                                                                <ContentPresenter Grid.Column="0" Grid.Row="0"
                                                                                      Grid.RowSpan="2"
                                                                                      Width="24" Height="24"
                                                                                      VerticalAlignment="Center"
                                                                                      ClipToBounds="True" Margin="6"
                                                                                      Content="{Binding ProviderInstance.IconElement}" />
                                                                <!-- 标题 -->
                                                                <TextBlock Grid.Column="1" Grid.Row="0"
                                                                               TextWrapping="Wrap"
                                                                               Text="{Binding Name}"
                                                                               FontSize="16" FontWeight="Bold" />
                                                                <!-- 描述 -->
                                                                <TextBlock Grid.Column="1" Grid.Row="1"
                                                                               TextWrapping="Wrap"
                                                                               Text="{Binding Description}"
                                                                               FontSize="12" />
                                                            </Grid>
                                                        </DataTemplate>
                                                    </ListBox.ItemTemplate>
                                                </ListBox>

                                            </TabItem>
                                            <TabItem Header="高级设置">
                                                <ScrollViewer Background="{DynamicResource MaterialDesignPaper}">
                                                    <StackPanel Margin="0 0 0 8">
                                                        <!-- 启用提醒语音 -->
                                                        <materialDesign:Card>
                                                            <Expander Background="Transparent"
                                                                      IsExpanded="{Binding Settings.AllowNotificationSpeech, Mode=OneWay}"
                                                                      TextBlock.Foreground="{DynamicResource MaterialDesignBody}"
                                                                      Margin="0 0 0 0">
                                                                <Expander.Header>
                                                                    <controls:SettingsControl IconGlyph="TextToSpeech"
                                                                        Foreground="{DynamicResource MaterialDesignBody}"
                                                                        Header="允许启用提醒语音"
                                                                        Description="在发出提醒时用语音播报提醒内容。"
                                                                        IsOn="{Binding Settings.AllowNotificationSpeech, Mode=TwoWay}"
                                                                        IsEnabled="{Binding Settings.IsNotificationSpeechEnabled, Mode=TwoWay}"
                                                                        Margin="-12 0" />
                                                                </Expander.Header>
                                                                <Grid Margin="36 0 48 12"
                                                                      IsEnabled="{Binding Settings.AllowNotificationSpeech}">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition />
                                                                        <ColumnDefinition Width="Auto" />
                                                                    </Grid.ColumnDefinitions>
                                                                    <Grid.RowDefinitions>
                                                                        <RowDefinition Height="Auto" />
                                                                        <RowDefinition Height="Auto" />
                                                                        <RowDefinition Height="Auto" />
                                                                        <RowDefinition Height="Auto" />
                                                                        <RowDefinition Height="Auto" />
                                                                        <RowDefinition Height="Auto" />
                                                                    </Grid.RowDefinitions>
                                                                    <CheckBox Content="默认启用" IsChecked="{Binding Settings.IsSpeechEnabled}"
                                                                              Margin="0 0 0 6"/>

                                                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="语音引擎"
                                                                           VerticalAlignment="Center" />
                                                                    <StackPanel Grid.Row="1" Grid.Column="1"
                                                                            Orientation="Horizontal"
                                                                            HorizontalAlignment="Right"
                                                                            VerticalAlignment="Center">
                                                                        <ListBox Style="{StaticResource MaterialDesignChoiceChipPrimaryOutlineListBox}"
                                                                             SelectedIndex="{Binding Settings.SpeechSource}">
                                                                            <ListBoxItem Content="系统TTS" IsEnabled="{Binding Settings.IsSystemSpeechSystemExist}"/>
                                                                            <ListBoxItem Content="Edge TTS" IsEnabled="{Binding Settings.IsNetworkConnect, Mode=TwoWay}"/>
                                                                        </ListBox>
                                                                    </StackPanel>

                                                                    <StackPanel Grid.Row="2" Grid.Column="0"
                                                                      Grid.ColumnSpan="2" Margin="0 6 0 6">
                                                                        <StackPanel.Style>
                                                                            <Style TargetType="StackPanel">
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding Settings.SpeechSource}" Value="1">
                                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                            </Style>
                                                                        </StackPanel.Style>
                                                                        <TextBlock TextWrapping="Wrap" Text="注意：EdgeTTS需要联网工作，并且可能存在一定延迟。" />
                                                                        <ComboBox Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                                                                              materialDesign:HintAssist.Hint="EdgeTTS说话人"
                                                                              SelectedValuePath="ShortName"
                                                                              SelectedValue="{Binding Settings.EdgeTtsVoiceName}"
                                                                              ItemsSource="{Binding ViewModel.EdgeVoices}">
                                                                            <ComboBox.ItemTemplate>
                                                                                <DataTemplate>
                                                                                    <TextBlock Text="{Binding FriendlyName}"/>
                                                                                </DataTemplate>
                                                                            </ComboBox.ItemTemplate>
                                                                        </ComboBox>
                                                                    </StackPanel>

                                                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="语音音量"
                                                                               VerticalAlignment="Center" 
                                                                               Margin="0 6 0 0"/>
                                                                    <StackPanel Grid.Row="3" Grid.Column="1"
                                                                        Orientation="Horizontal"
                                                                        HorizontalAlignment="Right"
                                                                        Margin="0 6 0 0"    
                                                                        VerticalAlignment="Center">
                                                                        <Slider Minimum="0" Maximum="1"
                                                                            Value="{Binding Settings.SpeechVolume}"
                                                                            TickFrequency="0.01"
                                                                            AutoToolTipPlacement="BottomRight"
                                                                            AutoToolTipPrecision="2"
                                                                            Width="150" />
                                                                    </StackPanel>

                                                                    <TextBox Grid.Row="4" Grid.Column="0"
                                                                         Grid.ColumnSpan="2"
                                                                         Margin="0 6 0 0"
                                                                         Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                                                         materialDesign:HintAssist.Hint="测试朗读文本"
                                                                         Text="{Binding ViewModel.TestSpeechText}"/>

                                                                    <WrapPanel Grid.Row="5" Grid.Column="0"
                                                                           Grid.ColumnSpan="2"
                                                                           Margin="0 6 0 0">
                                                                        <Button Click="ButtonTestSpeeching_OnClick"
                                                                            HorizontalAlignment="Left"
                                                                            Style="{StaticResource MaterialDesignFlatButton}">
                                                                            <controls:IconText Kind="Play"
                                                                            Text="测试语音" />
                                                                        </Button>
                                                                        <Button Click="ButtonOpenSpeechSettings_OnClick"
                                                                            HorizontalAlignment="Left"
                                                                            Style="{StaticResource MaterialDesignFlatButton}">
                                                                            <controls:IconText Kind="ExternalLink"
                                                                            Text="系统文本转语音设置" />
                                                                        </Button>
                                                                    </WrapPanel>
                                                                </Grid>
                                                            </Expander>
                                                        </materialDesign:Card>
                                                        <!-- 启用提醒强调特效 -->
                                                        <materialDesign:Card Margin="0 6 0 0">
                                                            <Expander Background="Transparent"
                                                                      IsExpanded="{Binding Settings.AllowNotificationEffect, Mode=OneWay}"
                                                                      TextBlock.Foreground="{DynamicResource MaterialDesignBody}"
                                                                      >
                                                                <Expander.Header>
                                                                    <controls:SettingsControl IconGlyph="LayersOutline"
                                                                        Foreground="{DynamicResource MaterialDesignBody}"
                                                                        Header="允许启用提醒强调特效"
                                                                        Description="启用后，发出提醒时会播放全屏强调特效。"
                                                                        IsOn="{Binding Settings.AllowNotificationEffect, Mode=TwoWay}"
                                                                        Margin="-12 0" />
                                                                </Expander.Header>
                                                                <StackPanel Margin="36 0 48 12"
                                                                            IsEnabled="{Binding Settings.AllowNotificationEffect}">
                                                                    <!-- 默认启用 -->
                                                                    <CheckBox Content="默认启用" IsChecked="{Binding Settings.IsNotificationEffectEnabled}"
                                                                              Margin="0 0 0 6"/>
                                                                    <!-- 提醒特效渲染精度 -->
                                                                    <controls:SettingsControl
                                                                        IconGlyph="LayersOutline" Header="提醒特效渲染精度"
                                                                        Foreground="{DynamicResource MaterialDesignBody}"
                                                                        Description="提醒特效渲染时的精度，使用较低的精度性能可以获得较好的性能。">
                                                                        <controls:SettingsControl.Switcher>
                                                                            <Slider Minimum="0.1" Maximum="1.5"
                                                                                TickFrequency="0.05"
                                                                                Width="150"
                                                                                Value="{Binding Settings.NotificationEffectRenderingScale}"
                                                                                AutoToolTipPlacement="BottomRight"
                                                                                AutoToolTipPrecision="2"
                                                                                IsSnapToTickEnabled="True"/>
                                                                        </controls:SettingsControl.Switcher>
                                                                    </controls:SettingsControl>
                                                                </StackPanel>
                                                            </Expander>
                                                        </materialDesign:Card>
                                                        <!-- 启用提醒音效 -->
                                                        <materialDesign:Card Margin="0 6 0 0">
                                                            <Expander Background="Transparent"
                                                                      IsExpanded="{Binding Settings.AllowNotificationSound, Mode=OneWay}"
                                                                      TextBlock.Foreground="{DynamicResource MaterialDesignBody}"
                                                                      >
                                                                <Expander.Header>
                                                                    <controls:SettingsControl IconGlyph="VolumeHigh"
                                                                        Foreground="{DynamicResource MaterialDesignBody}"
                                                                        Header="允许启用提醒音效"
                                                                        Description="启用后，发出提醒时会播放音效。"
                                                                        IsOn="{Binding Settings.AllowNotificationSound, Mode=TwoWay}"
                                                                        Margin="-12 0" />
                                                                </Expander.Header>
                                                                <StackPanel Margin="36 0 48 12"
                                                                            IsEnabled="{Binding Settings.AllowNotificationSound}">
                                                                    <!-- 默认启用 -->
                                                                    <CheckBox Content="默认启用" IsChecked="{Binding Settings.IsNotificationSoundEnabled}"
                                                                              Margin="0 0 0 6"/>
                                                                    <!-- 自定义音效 -->
                                                                    <controls:SettingsControl
                                                                        IconGlyph="FileMusicOutline" Header="自定义音效"
                                                                        Foreground="{DynamicResource MaterialDesignBody}"
                                                                        Description="设置自定义音效，留空以禁用。如果音效长于提醒显示时间，多出来的部分会被截断。">
                                                                        <controls:SettingsControl.Switcher>
                                                                            <StackPanel Orientation="Horizontal"
                                                                                HorizontalAlignment="Right"
                                                                                VerticalAlignment="Center">
                                                                                <TextBox MinWidth="150" MaxWidth="150"
                                                                                    materialDesign:HintAssist.Hint="（默认音效）"
                                                                                    Text="{Binding Settings.NotificationSoundPath}"
                                                                                    VerticalAlignment="Center"
                                                                                    Margin="0 0 2 0" />
                                                                                <controls:FileBrowserButton
                                                                                    CurrentPath="{Binding Settings.NotificationSoundPath, Mode=TwoWay}"
                                                                                    VerticalAlignment="Center" />
                                                                            </StackPanel>
                                                                        </controls:SettingsControl.Switcher>
                                                                    </controls:SettingsControl>
                                                                </StackPanel>
                                                            </Expander>
                                                        </materialDesign:Card>
                                                        <!-- 置顶提醒 -->
                                                        <materialDesign:Card Margin="0 6 0 0">
                                                            <Expander Background="Transparent"
                                                                      IsExpanded="{Binding Settings.AllowNotificationTopmost, Mode=OneWay}"
                                                                      TextBlock.Foreground="{DynamicResource MaterialDesignBody}"
                                                                      >
                                                                <Expander.Header>
                                                                    <controls:SettingsControl IconGlyph="LayersPlus"
                                                                        Margin="-12 0"
                                                                        Foreground="{DynamicResource MaterialDesignBody}"
                                                                        Header="允许置顶提醒"
                                                                        Description="在发出提醒时置顶提醒" 
                                                                        IsOn="{Binding Settings.AllowNotificationTopmost, Mode=TwoWay}"/>
                                                                </Expander.Header>
                                                                <StackPanel Margin="36 0 48 12"
                                                                            IsEnabled="{Binding Settings.AllowNotificationTopmost}">
                                                                    <!-- 默认启用 -->
                                                                    <CheckBox Content="默认启用" IsChecked="{Binding Settings.IsNotificationTopmostEnabled}"
                                                                              Margin="0 0 0 6"/>
                                                                </StackPanel>
                                                            </Expander>
                                                        </materialDesign:Card>
                                                    </StackPanel>
                                                </ScrollViewer>
                                            </TabItem>
                                        </TabControl>
                                        
                                        <!--<TextBlock Grid.Row="1" Text="{Binding ViewModel.NotificationSettingsSelectedProvider}"></TextBlock>-->
                                    </Grid>
                                </controls:ListDetailView.LeftContent>
                                <controls:ListDetailView.RightContent>
                                    <!-- 提醒详细信息 -->
                                    <Grid>
                                        <Grid>
                                            <Grid.Style>
                                                <Style TargetType="Grid">
                                                    <Style.Triggers>
                                                        <DataTrigger
                                                            Binding="{Binding ViewModel.NotificationSettingsSelectedProvider, Mode=TwoWay}"
                                                            Value="{x:Null}">
                                                            <Setter Property="Visibility" Value="Collapsed" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Grid.Style>
                                            <Grid
                                                DataContext="{Binding ViewModel.NotificationSettingsSelectedProvider, Converter={StaticResource GuidToNotificationProviderConverter}, Mode=OneWay}"
                                                d:DataContext="{d:DesignInstance notification:NotificationProviderRegisterInfo}">
                                                <ContentPresenter ClipToBounds="True"
                                                                  Margin="0 48 0 0"
                                                                  Content="{Binding ProviderInstance.SettingsElement}" />
                                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                                    <StackPanel.Style>
                                                        <Style TargetType="StackPanel">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding ProviderInstance.SettingsElement}"
                                                                             Value="{x:Null}">
                                                                    <Setter Property="Visibility" Value="Visible" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                            <Setter Property="Visibility" Value="Collapsed" />
                                                        </Style>
                                                    </StackPanel.Style>
                                                    <materialDesign:PackIcon Kind="Cog" Width="72" Height="72"
                                                                             HorizontalAlignment="Center" />
                                                    <TextBlock Text="该提醒提供方没有设置。" TextWrapping="Wrap"
                                                               Margin="0 8 0 0" />
                                                </StackPanel>

                                                <Expander
                                                    VerticalAlignment="Top"
                                                  Background="{DynamicResource MaterialDesignPaper}">
                                                    <Expander.Header>
                                                        <StackPanel Orientation="Horizontal">
                                                            <ToggleButton Margin="0 0 4 0" IsChecked="{Binding ProviderSettings.IsSettingsEnabled}"/>
                                                            <TextBlock Text="对此提醒来源启用特殊高级设置"/>
                                                        </StackPanel>
                                                    </Expander.Header>
                                                    <ScrollViewer Background="{DynamicResource MaterialDesignPaper}">
                                                        <StackPanel Margin="0 0 0 8"
                                                                    IsEnabled="{Binding ProviderSettings.IsSettingsEnabled}">
                                                            <TextBlock Text="此处的设置将覆盖全局设置和提醒请求中要求的设置。" Margin="2 4"
                                                                       Visibility="{Binding ProviderSettings.IsSettingsEnabled, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                                            <!-- 启用提醒语音 -->
                                                            <controls:SettingsCard IconGlyph="TextToSpeech"
                                                                Foreground="{DynamicResource MaterialDesignBody}"
                                                                Header="启用提醒语音"
                                                                Description="在发出提醒时用语音播报提醒内容。"
                                                                IsOn="{Binding ProviderSettings.IsSpeechEnabled, Mode=TwoWay}"/>
                                                            <!-- 启用提醒强调特效 -->
                                                            <controls:SettingsCard IconGlyph="LayersOutline"
                                                                               Margin="0 6 0 0"
                                                                               Foreground="{DynamicResource MaterialDesignBody}"
                                                                               Header="启用提醒强调特效"
                                                                               Description="启用后，发出提醒时会播放全屏强调特效。" 
                                                                               IsOn="{Binding ProviderSettings.IsNotificationEffectEnabled, Mode=TwoWay}"/>
                                                            <!-- 启用提醒音效 -->
                                                            <materialDesign:Card Margin="0 6 0 0">
                                                                <Expander Background="Transparent"
                                                                      IsExpanded="{Binding ProviderSettings.IsNotificationSoundEnabled, Mode=OneWay}"
                                                                      TextBlock.Foreground="{DynamicResource MaterialDesignBody}"
                                                                      >
                                                                    <Expander.Header>
                                                                        <controls:SettingsControl IconGlyph="VolumeHigh"
                                                                        Foreground="{DynamicResource MaterialDesignBody}"
                                                                        Header="启用提醒音效"
                                                                        Description="启用后，发出提醒时会播放音效。"
                                                                        IsOn="{Binding ProviderSettings.IsNotificationSoundEnabled, Mode=TwoWay}"
                                                                        Margin="-12 0" />
                                                                    </Expander.Header>
                                                                    <StackPanel Margin="36 0 48 12"
                                                                        IsEnabled="{Binding ProviderSettings.IsNotificationSoundEnabled}">
                                                                        <!-- 自定义音效 -->
                                                                        <controls:SettingsControl
                                                                            IconGlyph="FileMusicOutline" Header="自定义音效"
                                                                            Foreground="{DynamicResource MaterialDesignBody}"
                                                                            Description="设置自定义音效，留空以禁用。如果音效长于提醒显示时间，多出来的部分会被截断。">
                                                                            <controls:SettingsControl.Switcher>
                                                                                <StackPanel Orientation="Horizontal"
                                                                                    HorizontalAlignment="Right"
                                                                                    VerticalAlignment="Center">
                                                                                    <TextBox MinWidth="150"
                                                                                        MaxWidth="150"
                                                                                        materialDesign:HintAssist.Hint="（默认音效）"
                                                                                        Text="{Binding ProviderSettings.NotificationSoundPath}"
                                                                                        VerticalAlignment="Center"
                                                                                        Margin="0 0 2 0" />
                                                                                    <controls:FileBrowserButton
                                                                                        CurrentPath="{Binding ProviderSettings.NotificationSoundPath, Mode=TwoWay}"
                                                                                        VerticalAlignment="Center" />
                                                                                </StackPanel>
                                                                            </controls:SettingsControl.Switcher>
                                                                        </controls:SettingsControl>
                                                                    </StackPanel>
                                                                </Expander>
                                                            </materialDesign:Card>
                                                            <!-- 置顶提醒 -->
                                                            <controls:SettingsCard IconGlyph="LayersOutline"
                                                                Margin="0 6 0 0"
                                                                Foreground="{DynamicResource MaterialDesignBody}"
                                                                Header="置顶提醒"
                                                                Description="在发出提醒时强制显示并置顶主界面。" 
                                                                IsOn="{Binding ProviderSettings.IsNotificationTopmostEnabled, Mode=TwoWay}"/>
                                                        </StackPanel>
                                                    </ScrollViewer>
                                                </Expander>

                                            </Grid>
                                        </Grid>
                                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                            <StackPanel.Style>
                                                <Style TargetType="StackPanel">
                                                    <Style.Triggers>
                                                        <DataTrigger
                                                            Binding="{Binding ViewModel.NotificationSettingsSelectedProvider}"
                                                            Value="{x:Null}">
                                                            <Setter Property="Visibility" Value="Visible" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                </Style>
                                            </StackPanel.Style>
                                            <Image Source="/Assets/HoYoStickers/普罗米修斯_查询.png" Width="72" Height="72"
                                                   ToolTip="普罗米修斯_查询" />
                                            <TextBlock Text="在左侧选择一个提醒提供方，然后在此处进行设置。" TextWrapping="Wrap"
                                                       Margin="0 4 0 0" />
                                        </StackPanel>
                                    </Grid>
                                </controls:ListDetailView.RightContent>
                            </controls:ListDetailView>
                        </TabItem>

                        <!-- 窗口 -->
                        <TabItem Header="窗口">
                            <ScrollViewer>
                                <StackPanel Style="{StaticResource SettingsPageStackPanelStyle}" Tag="CanPolicyDisable">
                                    <!-- 窗口停靠位置 -->
                                    <controls:IconText Kind="Monitor" Text="窗口停靠位置" />
                                    <Grid Margin="0 12 0 0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" Margin="0 0 8 0">
                                            <materialDesign:ColorZone
                                                BorderBrush="{DynamicResource MaterialDesignBody}"
                                                BorderThickness="8" CornerRadius="4"
                                                VerticalAlignment="Center"
                                                Height="220">
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition />
                                                        <RowDefinition Height="Auto" />
                                                    </Grid.RowDefinitions>
                                                    <Grid Grid.Row="0" Margin="8">
                                                        <RadioButton VerticalAlignment="Top" HorizontalAlignment="Left"
                                                                     IsChecked="{Binding Settings.WindowDockingLocation, Converter={StaticResource IntToRadioButtonSelectionConverter}, ConverterParameter=0}" />
                                                        <RadioButton VerticalAlignment="Top"
                                                                     HorizontalAlignment="Center"
                                                                     IsChecked="{Binding Settings.WindowDockingLocation, Converter={StaticResource IntToRadioButtonSelectionConverter}, ConverterParameter=1}" />
                                                        <RadioButton VerticalAlignment="Top"
                                                                     HorizontalAlignment="Right"
                                                                     IsChecked="{Binding Settings.WindowDockingLocation, Converter={StaticResource IntToRadioButtonSelectionConverter}, ConverterParameter=2}" />

                                                        <RadioButton VerticalAlignment="Bottom"
                                                                     HorizontalAlignment="Left"
                                                                     IsChecked="{Binding Settings.WindowDockingLocation, Converter={StaticResource IntToRadioButtonSelectionConverter}, ConverterParameter=3}" />
                                                        <RadioButton VerticalAlignment="Bottom"
                                                                     HorizontalAlignment="Center"
                                                                     IsChecked="{Binding Settings.WindowDockingLocation, Converter={StaticResource IntToRadioButtonSelectionConverter}, ConverterParameter=4}" />
                                                        <RadioButton VerticalAlignment="Bottom"
                                                                     HorizontalAlignment="Right"
                                                                     IsChecked="{Binding Settings.WindowDockingLocation, Converter={StaticResource IntToRadioButtonSelectionConverter}, ConverterParameter=5}" />
                                                    </Grid>
                                                    <materialDesign:ColorZone Mode="Dark" Grid.Row="1" Height="16"
                                                                              Background="#99000000"
                                                                              BorderThickness="0">
                                                        <Grid>
                                                            <materialDesign:PackIcon Kind="MicrosoftWindows"
                                                                Height="10" Width="10" VerticalAlignment="Center"
                                                                HorizontalAlignment="Left" Margin="3" />
                                                            <TextBlock
                                                                Text="{Binding MainViewModel.Today, StringFormat={}{0:HH:mm}}"
                                                                FontSize="8" FontWeight="Light"
                                                                HorizontalAlignment="Right" VerticalAlignment="Center"
                                                                Margin="3" />
                                                        </Grid>
                                                    </materialDesign:ColorZone>
                                                </Grid>
                                            </materialDesign:ColorZone>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" HorizontalAlignment="Stretch"
                                                    Margin="8 0 0 0">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <!-- 向右偏移 -->
                                                <controls:NumbericTextBox Grid.Column="0"
                                                                          Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                                                          Padding="6" Margin="0 0 4 0"
                                                                          materialDesign:HintAssist.Hint="向右偏移"
                                                                          Text="{Binding Settings.WindowDockingOffsetX, Converter={StaticResource IntToStringConverter}}" />
                                                <!-- 向下偏移 -->
                                                <controls:NumbericTextBox Grid.Column="1"
                                                                          Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                                                          Padding="6" Margin="4 0 0 0"
                                                                          materialDesign:HintAssist.Hint="向下偏移"
                                                                          Text="{Binding Settings.WindowDockingOffsetY, Converter={StaticResource IntToStringConverter}}" />
                                            </Grid>
                                            <!-- 显示器 -->
                                            <ComboBox Margin="0 12 0 0"
                                                      Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                                      materialDesign:HintAssist.Hint="显示器"
                                                      SelectedIndex="{Binding Settings.WindowDockingMonitorIndex}"
                                                      ItemsSource="{Binding ViewModel.Screens, Mode=OneWay}">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <materialDesign:PackIcon Kind="Monitor"
                                                                VerticalAlignment="Center" />
                                                            <TextBlock VerticalAlignment="Center" Margin="6 0 0 0">
                                                                <Run Text="{Binding DeviceName, Mode=OneWay}" />
                                                                <Run Text="(">
                                                                </Run>
                                                                <Run Text="{Binding Bounds.Width, Mode=OneWay}">
                                                                </Run>
                                                                <Run Text="x">
                                                                </Run>
                                                                <Run Text="{Binding Bounds.Height, Mode=OneWay}">
                                                                </Run>
                                                                <Run Text=")" />
                                                            </TextBlock>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>

                                            <Button Margin="0 8 0 0" Style="{StaticResource MaterialDesignFlatButton}"
                                                    HorizontalAlignment="Left" Click="ButtonRefreshMonitors_OnClick">
                                                <controls:IconText Kind="Refresh" Text="刷新显示器列表" />
                                            </Button>

                                            <TextBlock Margin="0 16 0 0" TextWrapping="Wrap"
                                                       Text="应用会以左图的位置显示在指定的显示器上。如果指定的显示器不存在，那么应用会显示在主显示器上。" />
                                            <!--<TextBlock Text="{Binding Settings.WindowDockingLocation, Mode=OneWay}"/>-->
                                        </StackPanel>
                                    </Grid>
                                    <Separator Margin="0 16" />

                                    <!-- 窗口层级 -->
                                    <controls:SettingsCard IconGlyph="LayersOutline" Header="窗口层级"
                                                           Description="窗口在屏幕上的层级。置底则会显示在所有窗口的后方，置顶则将显示在所有窗口的前方。">
                                        <controls:SettingsCard.Switcher>
                                            <ComboBox SelectedIndex="{Binding Settings.WindowLayer, Mode=TwoWay}"
                                                      Foreground="{DynamicResource MaterialDesignBody}">
                                                <ComboBoxItem>
                                                    <controls:IconText Kind="LayersMinus" Text="置底" />
                                                </ComboBoxItem>
                                                <ComboBoxItem>
                                                    <controls:IconText Kind="LayersPlus" Text="置顶" />
                                                </ComboBoxItem>
                                            </ComboBox>
                                        </controls:SettingsCard.Switcher>
                                    </controls:SettingsCard>

                                    <!-- 指针穿透 -->
                                    <!--
                                <controls:SettingsCard IconGlyph="MouseMoveUp" Header="启用鼠标点击"
                                                       Description="启用时鼠标可以与主界面窗口上的元素交互。若禁用，那么鼠标在点击应用主界面窗口时，会穿透到窗口后方。"
                                                       IsOn="{Binding Settings.IsMouseClickingEnabled, Mode=TwoWay}" />-->

                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>

                        <!-- 天气 -->
                        <TabItem Header="天气">
                            <ScrollViewer>
                                <StackPanel Style="{StaticResource SettingsPageStackPanelStyle}" Tag="CanPolicyDisable">
                                    <controls:IconText Kind="WeatherSunny" Text="天气预览" Margin="0 0 0 8" />
                                    <StackPanel Orientation="Horizontal">
                                        <controls:WeatherPackIconControl Width="32" Height="32"
                                                                         Code="{Binding Settings.LastWeatherInfo.Current.Weather}"
                                                                         VerticalAlignment="Center" />
                                        <TextBlock VerticalAlignment="Center" FontSize="20" Margin="6 0 0 0">
                                            <Run Text="{Binding Settings.LastWeatherInfo.Current.Temperature.Value}">
                                            </Run><Run Text="{Binding Settings.LastWeatherInfo.Current.Temperature.Unit}" />
                                        </TextBlock>
                                        <Button Content="刷新" Style="{StaticResource MaterialDesignFlatButton}"
                                                HorizontalAlignment="Left"
                                                Click="ButtonRefreshWeather_OnClick"
                                                Margin="6 0 0 0" />
                                    </StackPanel>
                                    <TextBlock
                                        Text="{Binding Settings.LastWeatherInfo.UpdateTime, Mode=OneWay, ConverterCulture=zh-CN}">
                                    </TextBlock>
                                    <ItemsControl ItemsSource="{Binding Settings.LastWeatherInfo.Alerts}"
                                                  Margin="0 3 0 0">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" Margin="0 2"
                                                            ToolTip="{Binding Detail}">
                                                    <materialDesign:PackIcon Kind="CloudWarning"
                                                                             VerticalAlignment="Center"
                                                                             Margin="0 0 4 0" />
                                                    <TextBlock VerticalAlignment="Center">
                                                        <Run Text="{Binding Title}" />
                                                    </TextBlock>
                                                </StackPanel>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <Separator Margin="0 16 0 8" />
                                    <controls:IconText Kind="CogOutline" Text="设置" Margin="0 0 0 8" />
                                    <!-- 城市选择 -->
                                    <controls:SettingsCard IconGlyph="MapOutline" Header="城市选择"
                                                           Description="选择当前所在的城市，以用于天气查询。仅支持国内天气查询。">
                                        <controls:SettingsCard.Switcher>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Settings.CityName}"
                                                           VerticalAlignment="Center" />
                                                <Button Content="{materialDesign:PackIcon EditOutline}" ToolTip="编辑"
                                                        Margin="6 0 0 0"
                                                        Style="{StaticResource MaterialDesignFlatButton}"
                                                        Click="ButtonEditCurrentCity_OnClick" />
                                            </StackPanel>
                                        </controls:SettingsCard.Switcher>
                                    </controls:SettingsCard>
                                    <TextBlock TextWrapping="Wrap" FontWeight="Regular" Margin="0 8 0 0">
                                        要调整天气提醒设置，请转到【提醒】选项卡。要调整天气快速信息设置，请在【基本】中快速信息相关选项中调整。
                                    </TextBlock>
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>

                        <!-- 更新 -->
                        <TabItem>
                            <TabItem.Header>
                                <materialDesign:Badged>
                                    <materialDesign:Badged.Style>
                                        <Style TargetType="materialDesign:Badged">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Settings.LastUpdateStatus}"
                                                             Value="UpToDate">
                                                    <Setter Property="Badge" Value="{x:Null}" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                            <Setter Property="Badge" Value="{materialDesign:PackIcon Upload}" />
                                        </Style>
                                    </materialDesign:Badged.Style>
                                    <TextBlock Text="更新" />
                                </materialDesign:Badged>
                            </TabItem.Header>
                            <ScrollViewer>
                                <StackPanel Style="{StaticResource SettingsPageStackPanelStyle}" >
                                    <!-- 更新状态 -->
                                    <Grid Margin="0 12 0 0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <!-- 更新状态图标 -->
                                        <materialDesign:PackIcon Grid.Column="0" Grid.Row="0"
                                                                 Width="48" Height="48"
                                                                 Margin="0 0 8 0">
                                            <materialDesign:PackIcon.Style>
                                                <Style TargetType="materialDesign:PackIcon">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Settings.LastUpdateStatus}"
                                                                     Value="UpToDate">
                                                            <Setter Property="Kind" Value="Recent" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Settings.LastUpdateStatus}"
                                                                     Value="UpdateAvailable">
                                                            <Setter Property="Kind" Value="Upload" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Settings.LastUpdateStatus}"
                                                                     Value="UpdateDownloaded">
                                                            <Setter Property="Kind" Value="MonitorDownload" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                    <Setter Property="Kind" Value="Recent" />
                                                </Style>
                                            </materialDesign:PackIcon.Style>
                                        </materialDesign:PackIcon>

                                        <!-- 更新状态说明 -->
                                        <StackPanel Grid.Column="1" Grid.Row="0" Margin="0,0,0,16">
                                            <TextBlock FontSize="28" FontWeight="Medium">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger
                                                                Binding="{Binding Settings.LastUpdateStatus, Mode=OneWay}"
                                                                Value="UpToDate">
                                                                <Setter Property="Text" Value="您已是最新。" />
                                                            </DataTrigger>
                                                            <DataTrigger
                                                                Binding="{Binding Settings.LastUpdateStatus, Mode=OneWay}"
                                                                Value="UpdateAvailable">
                                                                <Setter Property="Text" Value="更新可用。" />
                                                            </DataTrigger>
                                                            <DataTrigger
                                                                Binding="{Binding Settings.LastUpdateStatus, Mode=OneWay}"
                                                                Value="UpdateDownloaded">
                                                                <Setter Property="Text" Value="您已准备好安装更新。" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>

                                            <TextBlock Margin="0 4 0 0">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger
                                                                Binding="{Binding Settings.LastUpdateStatus, Mode=OneWay}"
                                                                Value="UpToDate">
                                                                <Setter Property="Visibility" Value="Visible" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </Style>
                                                </TextBlock.Style>
                                                <Run Text="上次检查更新：">
                                                </Run>
                                                <Run
                                                    Text="{Binding Settings.LastCheckUpdateTime, Mode=OneWay, ConverterCulture=zh-cn}" />
                                            </TextBlock>

                                            <TextBlock Margin="0 4 0 0">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger
                                                                Binding="{Binding Settings.LastUpdateStatus, Mode=OneWay}"
                                                                Value="UpToDate">
                                                                <Setter Property="Visibility" Value="Collapsed" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Visible" />
                                                    </Style>
                                                </TextBlock.Style>
                                                <Run Text="新版本：">
                                                </Run>
                                                <Run Text="{Binding Settings.UpdateVersion, Mode=OneWay}" />
                                            </TextBlock>
                                        </StackPanel>

                                        <!-- 进度条 -->
                                        <StackPanel Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="1"
                                                    HorizontalAlignment="Stretch"
                                                    Margin="0 0 0 8">
                                            <StackPanel.Style>
                                                <Style TargetType="StackPanel">
                                                    <Style.Triggers>
                                                        <DataTrigger
                                                            Binding="{Binding UpdateService.CurrentWorkingStatus, Mode=OneWay}"
                                                            Value="Idle">
                                                            <Setter Property="Visibility" Value="Collapsed" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </StackPanel.Style>

                                            <TextBlock>
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger
                                                                Binding="{Binding UpdateService.CurrentWorkingStatus, Mode=OneWay}"
                                                                Value="CheckingUpdates">
                                                                <Setter Property="Text" Value="正在检查更新……" />
                                                            </DataTrigger>
                                                            <DataTrigger
                                                                Binding="{Binding UpdateService.CurrentWorkingStatus, Mode=OneWay}"
                                                                Value="NetworkError">
                                                                <Setter Property="Text" Value="网络错误。请检查网络连接，然后再试一遍。" />
                                                            </DataTrigger>
                                                            <DataTrigger
                                                                Binding="{Binding UpdateService.CurrentWorkingStatus, Mode=OneWay}"
                                                                Value="DownloadingUpdates">
                                                                <Setter Property="Text" Value="正在下载更新……" />
                                                            </DataTrigger>
                                                            <DataTrigger
                                                                Binding="{Binding UpdateService.CurrentWorkingStatus, Mode=OneWay}"
                                                                Value="ExtractingUpdates">
                                                                <Setter Property="Text" Value="正在解压更新……" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>

                                            </TextBlock>
                                            <TextBlock>
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger
                                                                Binding="{Binding UpdateService.CurrentWorkingStatus}"
                                                                Value="DownloadingUpdates">
                                                                <Setter Property="Visibility" Value="Visible" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </Style>
                                                </TextBlock.Style>
                                                <Run
                                                    Text="{Binding UpdateService.DownloadedSize, Converter={StaticResource SizeLongToStringConverter}}" />
                                                <Run Text="/" />
                                                <Run
                                                    Text="{Binding UpdateService.TotalSize, Converter={StaticResource SizeLongToStringConverter}}" />
                                                <Run
                                                    Text="{Binding UpdateService.DownloadSpeed, Converter={StaticResource SizeLongToStringConverter}}" />
                                                <Run Text="/s" />
                                                <Run Text="ETA" />
                                                <Run Text="{Binding UpdateService.DownloadEtcSeconds}" />
                                            </TextBlock>

                                            <ProgressBar Margin="0 3 0 0">
                                                <ProgressBar.Style>
                                                    <Style TargetType="ProgressBar"
                                                           BasedOn="{StaticResource MaterialDesignLinearProgressBar}">
                                                        <Style.Triggers>
                                                            <DataTrigger
                                                                Binding="{Binding UpdateService.CurrentWorkingStatus, Mode=OneWay}"
                                                                Value="CheckingUpdates">
                                                                <Setter Property="IsIndeterminate" Value="True" />
                                                            </DataTrigger>
                                                            <DataTrigger
                                                                Binding="{Binding UpdateService.CurrentWorkingStatus, Mode=OneWay}"
                                                                Value="ExtractingUpdates">
                                                                <Setter Property="IsIndeterminate" Value="True" />
                                                            </DataTrigger>
                                                            <DataTrigger
                                                                Binding="{Binding UpdateService.CurrentWorkingStatus, Mode=OneWay}"
                                                                Value="DownloadingUpdates">
                                                                <Setter Property="IsIndeterminate" Value="False" />
                                                                <Setter Property="Value"
                                                                        Value="{Binding UpdateService.DownloadedSize, Mode=OneWay}" />
                                                                <Setter Property="Maximum"
                                                                        Value="{Binding UpdateService.TotalSize, Mode=OneWay}" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </ProgressBar.Style>
                                            </ProgressBar>
                                        </StackPanel>

                                        <!-- 网络错误 -->
                                        <materialDesign:Snackbar Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                                                 HorizontalAlignment="Stretch"
                                                                 IsActive="True"
                                                                 Margin="0 6">
                                            <materialDesign:Snackbar.Style>
                                                <Style TargetType="materialDesign:Snackbar">
                                                    <Style.Triggers>
                                                        <DataTrigger
                                                            Binding="{Binding UpdateService.NetworkErrorException}"
                                                            Value="{x:Null}">
                                                            <Setter Property="Visibility" Value="Collapsed" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </materialDesign:Snackbar.Style>
                                            <materialDesign:Snackbar.Message>
                                                <materialDesign:SnackbarMessage ActionContent="确定"
                                                    Content="网络错误，请检查网络连接，然后再试一遍。"
                                                    ActionClick="UpdateErrorMessage_OnActionClick" />
                                            </materialDesign:Snackbar.Message>
                                        </materialDesign:Snackbar>

                                        <!-- 更新操作栏 -->
                                        <WrapPanel Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="3"
                                                   Margin="0 6 0 0"
                                                   Visibility="Visible">
                                            <WrapPanel.Style>
                                                <Style TargetType="WrapPanel">
                                                    <Style.Triggers>
                                                        <DataTrigger
                                                            Binding="{Binding UpdateService.CurrentWorkingStatus, Mode=OneWay}"
                                                            Value="CheckingUpdates">
                                                            <Setter Property="IsEnabled" Value="False" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </WrapPanel.Style>
                                            <!-- 检查更新 -->
                                            <Button Margin="0 0 6 0" Click="ButtonCheckUpdate_OnClick">
                                                <Button.Style>
                                                    <Style TargetType="Button"
                                                           BasedOn="{StaticResource MaterialDesignRaisedButton}">
                                                        <Style.Triggers>
                                                            <DataTrigger
                                                                Binding="{Binding Settings.LastUpdateStatus, Mode=OneWay}"
                                                                Value="UpToDate">
                                                                <Setter Property="Visibility" Value="Visible" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </Style>
                                                </Button.Style>
                                                <controls:IconText Kind="Refresh" Text="检查更新" />
                                            </Button>
                                            <!-- 下载更新  -->
                                            <Button Margin="0 0 6 0" Click="ButtonStartDownloading_OnClick">
                                                <Button.Style>
                                                    <Style TargetType="Button"
                                                           BasedOn="{StaticResource MaterialDesignRaisedButton}">
                                                        <Style.Triggers>
                                                            <DataTrigger
                                                                Binding="{Binding Settings.LastUpdateStatus, Mode=OneWay}"
                                                                Value="UpdateAvailable">
                                                                <Setter Property="Visibility" Value="Visible" />
                                                            </DataTrigger>
                                                            <DataTrigger
                                                                Binding="{Binding UpdateService.CurrentWorkingStatus, Mode=OneWay}"
                                                                Value="DownloadingUpdates">
                                                                <Setter Property="Visibility" Value="Collapsed" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </Style>
                                                </Button.Style>
                                                <controls:IconText Kind="Download" Text="下载更新" />
                                            </Button>
                                            <!-- 检查更新 paper  -->
                                            <Button Margin="0 0 6 0"
                                                    Click="ButtonCheckUpdate_OnClick">
                                                <Button.Style>
                                                    <Style TargetType="Button"
                                                           BasedOn="{StaticResource MaterialDesignPaperButton}">
                                                        <Style.Triggers>
                                                            <DataTrigger
                                                                Binding="{Binding Settings.LastUpdateStatus, Mode=OneWay}"
                                                                Value="UpdateAvailable">
                                                                <Setter Property="Visibility" Value="Visible" />
                                                            </DataTrigger>
                                                            <DataTrigger
                                                                Binding="{Binding UpdateService.CurrentWorkingStatus, Mode=OneWay}"
                                                                Value="DownloadingUpdates">
                                                                <Setter Property="Visibility" Value="Collapsed" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </Style>
                                                </Button.Style>
                                                <controls:IconText Kind="Refresh" Text="检查更新" />
                                            </Button>
                                            <!-- 重启并安装更新  -->
                                            <Button Margin="0 0 6 0" Click="ButtonRestartToUpdate_OnClick">
                                                <Button.Style>
                                                    <Style TargetType="Button"
                                                           BasedOn="{StaticResource MaterialDesignRaisedButton}">
                                                        <Style.Triggers>
                                                            <DataTrigger
                                                                Binding="{Binding Settings.LastUpdateStatus, Mode=OneWay}"
                                                                Value="UpdateDownloaded">
                                                                <Setter Property="Visibility" Value="Visible" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </Style>
                                                </Button.Style>
                                                <controls:IconText Kind="MonitorDownload" Text="重启并安装更新" />
                                            </Button>
                                            <!-- 取消更新  -->
                                            <Button Margin="0 0 6 0" Click="ButtonCancelUpdate_OnClick">
                                                <Button.Style>
                                                    <Style TargetType="Button"
                                                           BasedOn="{StaticResource MaterialDesignPaperButton}">
                                                        <Style.Triggers>
                                                            <DataTrigger
                                                                Binding="{Binding UpdateService.CurrentWorkingStatus, Mode=OneWay}"
                                                                Value="DownloadingUpdates">
                                                                <Setter Property="Visibility" Value="Visible" />
                                                            </DataTrigger>
                                                            <DataTrigger
                                                                Binding="{Binding Settings.LastUpdateStatus, Mode=OneWay}"
                                                                Value="UpdateDownloaded">
                                                                <Setter Property="Visibility" Value="Visible" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </Style>
                                                </Button.Style>
                                                <controls:IconText Kind="Cancel" Text="取消更新" />
                                            </Button>
                                            <!-- debug -->
                                            <Button Content="（debug）重置更新状态"
                                                    Style="{StaticResource MaterialDesignFlatButton}"
                                                    Click="ButtonDebugResetUpdate_OnClick"
                                                    Visibility="{Binding Settings.IsDebugEnabled, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                            <Button Content="（debug）下载完成"
                                                    Style="{StaticResource MaterialDesignFlatButton}"
                                                    Click="ButtonDebugDownloaded_OnClick"
                                                    Visibility="{Binding Settings.IsDebugEnabled, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                            <Button Content="（debug）网络错误"
                                                    Style="{StaticResource MaterialDesignFlatButton}"
                                                    Click="ButtonDebugNetworkError_OnClick"
                                                    Visibility="{Binding Settings.IsDebugEnabled, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                        </WrapPanel>

                                        <!-- 加载中 -->
                                        <ProgressBar Grid.Column="0" Grid.Row="3"
                                                     HorizontalAlignment="Left"
                                                     Visibility="Collapsed"
                                                     Style="{StaticResource MaterialDesignCircularProgressBar}"
                                                     IsIndeterminate="True"
                                                     Value="0" Margin="0,9,0,9" />

                                        <!-- 重启更新 -->
                                        <CheckBox Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="2"
                                                  Margin="0,8,0,0"
                                                  IsChecked="{Binding Settings.AutoInstallUpdateNextStartup}"
                                                  Content="在下次启动应用时自动安装更新。">
                                            <CheckBox.Style>
                                                <Style TargetType="CheckBox"
                                                       BasedOn="{StaticResource MaterialDesignCheckBox}">
                                                    <Style.Triggers>
                                                        <DataTrigger
                                                            Binding="{Binding Settings.LastUpdateStatus, Mode=OneWay}"
                                                            Value="UpdateDownloaded">
                                                            <Setter Property="Visibility" Value="Visible" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                </Style>
                                            </CheckBox.Style>
                                        </CheckBox>
                                    </Grid>

                                    <Separator Margin="0 16" />

                                    <!-- Content -->
                                    <TabControl HorizontalContentAlignment="Left">
                                        <TabItem Header="更新日志">
                                            <Grid>
                                                <Grid>
                                                    <Grid.Style>
                                                        <Style TargetType="Grid">
                                                            <Style.Triggers>
                                                                <DataTrigger
                                                                    Binding="{Binding Settings.LastUpdateStatus}"
                                                                    Value="UpToDate">
                                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Grid.Style>
                                                    <mdxaml:MarkdownScrollViewer
                                                        Document="{Binding ViewModel.CurrentMarkdownDocument, Mode=OneWay}"
                                                        ScrollViewer.VerticalScrollBarVisibility="Disabled"
                                                        PreviewMouseWheel="UIElement_OnPreviewMouseWheel" />
                                                </Grid>
                                                <!-- Up to date -->
                                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                                            Margin="0 50">
                                                    <StackPanel.Style>
                                                        <Style TargetType="StackPanel">
                                                            <Style.Triggers>
                                                                <DataTrigger
                                                                    Binding="{Binding Settings.LastUpdateStatus}"
                                                                    Value="UpToDate">
                                                                    <Setter Property="Visibility" Value="Visible" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                            <Setter Property="Visibility" Value="Collapsed" />
                                                        </Style>
                                                    </StackPanel.Style>
                                                    <Image Source="/Assets/HoYoStickers/光辉矢愿_遨游.png" Width="81"
                                                           Height="81"
                                                           ToolTip="光辉矢愿_遨游" />
                                                    <TextBlock Text="你已是最新，真棒，夸夸你哦♪" TextWrapping="Wrap"
                                                               Margin="0 8 0 0" />
                                                    <Button HorizontalAlignment="Center" Margin="0 8 0 0"
                                                            Style="{StaticResource MaterialDesignFlatButton}"
                                                            Click="ButtonChangelogs_OnClick">
                                                        <controls:IconText Kind="FileDocumentOutline" Text="查看新增功能"/>
                                                    </Button>
                                                </StackPanel>
                                                <!-- Loading -->
                                                <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                                                    <Grid.Style>
                                                        <Style TargetType="Grid">
                                                            <Style.Triggers>
                                                                <DataTrigger
                                                                    Binding="{Binding UpdateService.CurrentWorkingStatus}"
                                                                    Value="CheckingUpdates">
                                                                    <Setter Property="Visibility" Value="Visible" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                            <Setter Property="Visibility" Value="Collapsed" />
                                                        </Style>
                                                    </Grid.Style>
                                                    <Border HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                                            Background="{DynamicResource MaterialDesignPaper}"
                                                            Opacity="0.8" />
                                                    <controls:StarRailLoadingControl />
                                                </Grid>
                                            </Grid>
                                        </TabItem>
                                        <TabItem Header="更新设置">
                                            <StackPanel Style="{StaticResource SettingsPageStackPanelStyle}" Margin="0" Tag="CanPolicyDisable">
                                                <!-- 更新模式 -->
                                                <materialDesign:Card Style="{StaticResource UpdateEnabledStyle}">
                                                    <StackPanel Margin="12">
                                                        <controls:IconText Kind="Upload" Text="更新模式" Margin="0 0 0 8" />
                                                        <Slider Margin="12" Minimum="0" Maximum="3"
                                                                Value="{Binding Settings.UpdateMode}"
                                                                TickFrequency="1"
                                                                Height="32"
                                                                ClipToBounds="False"
                                                                IsSnapToTickEnabled="True"
                                                                TickPlacement="BottomRight" />
                                                        <!-- 更新模式说明 -->
                                                        <controls:IconText Margin="0 -8 0 0">
                                                            <controls:IconText.Style>
                                                                <Style TargetType="controls:IconText">
                                                                    <Style.Triggers>
                                                                        <DataTrigger
                                                                            Binding="{Binding Settings.UpdateMode, Mode=OneWay}"
                                                                            Value="0">
                                                                            <Setter Property="Kind" Value="Cancel" />
                                                                            <Setter Property="Text" Value="从不自动检查更新。" />
                                                                        </DataTrigger>
                                                                        <DataTrigger
                                                                            Binding="{Binding Settings.UpdateMode, Mode=OneWay}"
                                                                            Value="1">
                                                                            <Setter Property="Kind" Value="RefreshAuto" />
                                                                            <Setter Property="Text"
                                                                                Value="自动检查更新，并在有更新时提醒我。" />
                                                                        </DataTrigger>
                                                                        <DataTrigger
                                                                            Binding="{Binding Settings.UpdateMode, Mode=OneWay}"
                                                                            Value="2">
                                                                            <Setter Property="Kind"
                                                                                Value="AutoDownload" />
                                                                            <Setter Property="Text"
                                                                                Value="自动检查更新，并在有更新时自动下载。" />
                                                                        </DataTrigger>
                                                                        <DataTrigger
                                                                            Binding="{Binding Settings.UpdateMode, Mode=OneWay}"
                                                                            Value="3">
                                                                            <Setter Property="Kind"
                                                                                Value="MonitorDownload" />
                                                                            <Setter Property="Text"
                                                                                Value="自动检查并下载更新，并自动安装。" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </controls:IconText.Style>
                                                        </controls:IconText>
                                                    </StackPanel>
                                                </materialDesign:Card>

                                                <!-- 更新通道 -->
                                                <materialDesign:Card Margin="0 6 0 0"
                                                                     Style="{StaticResource UpdateEnabledStyle}">
                                                    <StackPanel Margin="12">
                                                        <controls:SettingsControl IconGlyph="DownloadOutline"
                                                            Header="更新通道"
                                                            Description="控制应用从何处获取更新。">
                                                            <controls:SettingsControl.Switcher>
                                                                <ComboBox Width="150"
                                                                          Foreground="{DynamicResource MaterialDesignBody}"
                                                                          ItemsSource="{x:Static services:UpdateService.UpdateChannels}"
                                                                          SelectedValue="{Binding Settings.SelectedChannel}"
                                                                          SelectedValuePath="RootUrl">
                                                                    <ComboBox.ItemTemplate>
                                                                        <DataTemplate>
                                                                            <TextBlock Text="{Binding Name}" />
                                                                        </DataTemplate>
                                                                    </ComboBox.ItemTemplate>
                                                                </ComboBox>
                                                            </controls:SettingsControl.Switcher>
                                                        </controls:SettingsControl>
                                                        <TextBlock Margin="0 8 0 0"
                                                                   FontWeight="Regular"
                                                                   TextWrapping="Wrap"
                                                                   Text="{Binding ViewModel.SelectedChannelModel.Description, Mode=OneWay}" />
                                                        <!--<TextBlock Text="{Binding Settings.SelectedChannel, Mode=OneWay}"/>-->
                                                        <!--<Button Content="管理更新频道" Style="{StaticResource MaterialDesignFlatButton}"
                                                            HorizontalAlignment="Left"
                                                            Margin="0 3 0 0" />-->
                                                    </StackPanel>
                                                </materialDesign:Card>

                                                <!-- 镜像源选择 -->
                                                <materialDesign:Card Margin="0 6 0 0"
                                                                     Style="{StaticResource UpdateEnabledStyle}">
                                                    <Expander Background="Transparent" IsExpanded="True">
                                                        <Expander.Header>
                                                            <controls:SettingsControl IconGlyph="Web"
                                                                Foreground="{DynamicResource MaterialDesignBody}"
                                                                Header="更新镜像源" HasSwitcher="False"
                                                                Description="从指定的镜像源下载应用更新，一定程度上可以解决在部分网络环境下更新受阻的问题。"
                                                                Margin="-12 0" />
                                                        </Expander.Header>
                                                        <StackPanel Margin="36 0 64 12">
                                                            <ListBox
                                                                ItemsSource="{x:Static services:UpdateService.UpdateSources}"
                                                                Margin="-36 0 -64 0"
                                                                PreviewMouseWheel="UIElement_OnPreviewMouseWheel"
                                                                SelectedValuePath="Key"
                                                                SelectedValue="{Binding Settings.SelectedUpgradeMirror}">
                                                                <ListBox.ItemTemplate>
                                                                    <DataTemplate>
                                                                        <StackPanel Orientation="Horizontal"
                                                                            Margin="36 0 64 0">
                                                                            <StackPanel Width="48">
                                                                                <materialDesign:PackIcon Kind="Check"
                                                                                    HorizontalAlignment="Center"
                                                                                    Foreground="{DynamicResource PrimaryHueMidBrush}"
                                                                                    Visibility="{Binding IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType=ListBoxItem}, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                                                            </StackPanel>
                                                                            <TextBlock Text="{Binding Value.Name}" />
                                                                            <StackPanel Orientation="Horizontal"
                                                                                Margin="8 0 0 0">
                                                                                <StackPanel.Style>
                                                                                    <Style TargetType="StackPanel">
                                                                                        <Style.Triggers>
                                                                                            <DataTrigger
                                                                                                Binding="{Binding Value.SpeedTestResult.IsTested}"
                                                                                                Value="False">
                                                                                                <Setter
                                                                                                    Property="Visibility"
                                                                                                    Value="Collapsed" />
                                                                                            </DataTrigger>
                                                                                            <DataTrigger
                                                                                                Binding="{Binding Value.SpeedTestResult.IsTesting}"
                                                                                                Value="True">
                                                                                                <Setter
                                                                                                    Property="Visibility"
                                                                                                    Value="Collapsed" />
                                                                                            </DataTrigger>
                                                                                        </Style.Triggers>
                                                                                    </Style>
                                                                                </StackPanel.Style>
                                                                                <TextBlock
                                                                                    Visibility="{Binding Value.SpeedTestResult.CanConnect, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                                                    <Run
                                                                                        Text="{Binding Value.SpeedTestResult.Delay}" />
                                                                                    <Run Text="ms" />
                                                                                </TextBlock>
                                                                                <TextBlock
                                                                                    Visibility="{Binding Value.SpeedTestResult.CanConnect, Converter={StaticResource InverseBoolToVisConverter}}">
                                                                                    <Run Text="无法连接。"
                                                                                        Foreground="IndianRed" />
                                                                                </TextBlock>
                                                                            </StackPanel>
                                                                            <mah:MetroProgressBar
                                                                                IsIndeterminate="True" Width="100"
                                                                                Margin="8 0 0 0"
                                                                                Foreground="{DynamicResource PrimaryHueMidBrush}"
                                                                                Visibility="{Binding Value.SpeedTestResult.IsTesting, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                                                        </StackPanel>
                                                                    </DataTemplate>
                                                                </ListBox.ItemTemplate>
                                                            </ListBox>
                                                            <Button Content="测试延迟"
                                                                    Click="MenuItemTestUpdateMirrors_OnClick"
                                                                    Style="{StaticResource MaterialDesignFlatButton}"
                                                                    HorizontalAlignment="Left"
                                                                    Margin="0 4 0 0" />
                                                            <Separator Margin="0 4" />
                                                            <controls:SettingsControl IsCompact="True"
                                                                IconGlyph="AutoMode"
                                                                Header="自动选择镜像源"
                                                                Description="自动选择延迟最低的镜像源下载更新。"
                                                                IsOn="{Binding Settings.IsAutoSelectUpgradeMirror, Mode=TwoWay}" />
                                                        </StackPanel>
                                                    </Expander>
                                                </materialDesign:Card>

                                                <!-- 高级设置 -->
                                                <Border Style="{StaticResource UpdateEnabledStyle}">
                                                    <Button Content="高级设置"
                                                            Style="{StaticResource MaterialDesignFlatButton}"
                                                            HorizontalAlignment="Left"
                                                            Margin="0 8 0 0"
                                                            Click="ButtonAdvancedSettings_OnClick" />
                                                </Border>
                                            </StackPanel>
                                        </TabItem>
                                    </TabControl>
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>

                        <!-- 隐私 -->
                        <TabItem Header="隐私">
                            <ScrollViewer>
                                <StackPanel Style="{StaticResource SettingsPageStackPanelStyle}" Tag="CanPolicyDisable">
                                    <StackPanel Margin="0 0 0 16">
                                        <TextBlock Text="匿名使用情况分析"
                                                   Style="{StaticResource MaterialDesignHeadline5TextBlock}" />
                                        <TextBlock Margin="0 6 0 0" TextWrapping="Wrap"
                                                   FontWeight="Light"
                                                   Text="本应用将通过Microsoft AppCenter，来收集本应用的使用情况与错误信息，以帮助改进本应用。您的信息会匿名上传，不会包含您的个人信息。您可以自行启用或禁用此功能。" />
                                        <TextBlock Margin="0 6 0 0" TextWrapping="Wrap"
                                                   FontWeight="Light">
                                            <Run Text="关于使用Microsoft AppCenter收集的数据，请见">
                                            </Run>
                                            <Hyperlink Click="HyperlinkMsAppCenter_OnClick">
                                                此处
                                            </Hyperlink>
                                            。
                                        </TextBlock>
                                    </StackPanel>
                                    <controls:SettingsCard IconGlyph="ReportLine"
                                                           Header="启用匿名使用情况分析"
                                                           IsOn="{Binding Settings.IsReportingEnabled, Mode=TwoWay}"
                                                           Description="启用后，应用将收集并上传应用的使用情况与错误信息，以帮助改进此应用。上传的信息不包含您的个人信息。" />
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>

                        <!-- 关于 -->
                        <TabItem Header="关于">
                            <ScrollViewer>
                                <StackPanel Margin="6" MaxWidth="750">
                                    <StackPanel>
                                        <!-- banner -->
                                        <!--<Grid Height="100">
                        <Image Source="/Assets/banner.png" Stretch="UniformToFill" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Grid>-->
                                        <Grid HorizontalAlignment="Stretch" Margin="12">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition />
                                            </Grid.ColumnDefinitions>
                                            <!-- icon -->
                                            <materialDesign:Ripple Grid.Column="0" VerticalAlignment="Top"
                                                                   MouseDown="AppIcon_OnMouseDown"
                                                                   ToolTip="ClassIsland">
                                                <Image Source="/Assets/AppLogo.ico" Width="40"
                                                       Height="40" VerticalAlignment="Top" />
                                            </materialDesign:Ripple>
                                            <!-- about -->
                                            <StackPanel Grid.Column="1" Margin="10 0 0 0">
                                                <TextBlock>
                                                    <Run Text="ClassIsland" FontSize="24" FontWeight="Bold" />
                                                    <LineBreak />
                                                    <Run Text="{x:Static ci:App.AppVersion}" />
                                                    <Run Text="(Codename " />
                                                    <Run Text="{x:Static ci:App.AppCodeName}" /><Run Text=")" />
                                                    <LineBreak />
                                                    <Run Text="{x:Static ci:App.AppVersionLong}" FontFamily="Consolas" />
                                                    <LineBreak />
                                                    <Run Text="Copyright (c) 2024 HelloWRC" />
                                                </TextBlock>
                                                <WrapPanel>
                                                    <Button HorizontalAlignment="Left" Margin="6"
                                                            Style="{StaticResource MaterialDesignFlatButton}"
                                                            Click="ButtonGithub_OnClick">
                                                        <controls:IconText Kind="MicrosoftGithub" Text="GitHub" />
                                                    </Button>
                                                    <Button HorizontalAlignment="Left" Margin="6"
                                                            Style="{StaticResource MaterialDesignFlatButton}"
                                                            Click="ButtonFeedback_OnClick">
                                                        <controls:IconText Kind="BugOutline" Text="问题反馈" />
                                                    </Button>
                                                    <Button HorizontalAlignment="Left" Margin="6"
                                                            Style="{StaticResource MaterialDesignFlatButton}"
                                                            Command="{x:Static materialDesign:DialogHost.OpenDialogCommand}">
                                                        <controls:IconText Kind="License" Text="开源许可" />
                                                        <Button.CommandParameter>
                                                            <StaticResource ResourceKey="OpenSourceLicense" />
                                                        </Button.CommandParameter>
                                                    </Button>
                                                    <Button HorizontalAlignment="Left" Margin="6"
                                                            Style="{StaticResource MaterialDesignFlatButton}"
                                                            Command="{x:Static materialDesign:DialogHost.OpenDialogCommand}"
                                                            Click="ButtonDiagnosticInfo_OnClick">
                                                        <controls:IconText Kind="BugOutline" Text="诊断信息" />
                                                        <Button.CommandParameter>
                                                            <StaticResource ResourceKey="DiagnosticInfoDialog" />
                                                        </Button.CommandParameter>
                                                    </Button>
                                                </WrapPanel>
                                            </StackPanel>
                                        </Grid>

                                    </StackPanel>

                                    <FlowDocumentScrollViewer ScrollViewer.VerticalScrollBarVisibility="Disabled"
                                                              IsSelectionEnabled="{Binding Settings.IsDebugEnabled, Mode=OneWay}"
                                                              PreviewMouseWheel="UIElement_OnPreviewMouseWheel"
                                                              ContextMenu="{x:Null}">
                                        <FlowDocument FontFamily="{StaticResource HarmonyOsSans}"
                                                      IsOptimalParagraphEnabled="True">
                                            <Paragraph>
                                                <Italic>「宇宙中有无数的星球，无尽的故事，无限的可能。即便仍被重力束缚，人类对未知的畅想永远不会停歇。」</Italic>
                                            </Paragraph>
                                            <Paragraph Style="{StaticResource MarkdownHeadline1Style}">
                                                关于本应用
                                            </Paragraph>
                                            <Paragraph>
                                                ClassIsland，名字灵感源于 iOS 灵动岛（Dynamic Island）功能，基于 WPF 开发，适用于班级多媒体屏幕的课表等信息显示工具，信息一目了然。
                                            </Paragraph>
                                            <Paragraph Style="{StaticResource MarkdownHeadline2Style}"
                                                       LineHeight="2">
                                                鸣谢：
                                            </Paragraph>
                                            <Paragraph TextBlock.LineHeight="1">
                                                <Button HorizontalAlignment="Left" Margin="6"
                                                        Style="{StaticResource MaterialDesignFlatButton}"
                                                        Click="ButtonContributors_OnClick">
                                                    <controls:IconText Kind="PeopleGroupOutline" Text="贡献人员" />
                                                </Button>
                                                <Button HorizontalAlignment="Left" Margin="6"
                                                        Style="{StaticResource MaterialDesignFlatButton}"
                                                        Click="ButtonThirdPartyLibs_OnClick">
                                                    <controls:IconText Kind="PackageVariant" Text="第三方库" />
                                                </Button>
                                            </Paragraph>
                                            <List LineHeight="6">
                                                <ListItem>
                                                    <Paragraph>
                                                        本项目受到
                                                        <Hyperlink Click="Hyperlink2_OnClick">DuguSand/class_form</Hyperlink>
                                                        的启发而开发。
                                                    </Paragraph>
                                                </ListItem>
                                                <ListItem>
                                                    <Paragraph>
                                                        界面主题和部分控件使用了 MaterialDesignInXamlToolkit 框架。
                                                    </Paragraph>
                                                </ListItem>
                                                <ListItem>
                                                    <Paragraph>
                                                        应用字体使用了华为出品的 HarmonyOS Sans。
                                                    </Paragraph>
                                                </ListItem>
                                                <ListItem>
                                                    <Paragraph>
                                                        协助本应用测试的同学。
                                                    </Paragraph>
                                                </ListItem>
                                                <ListItem>
                                                    <Paragraph>
                                                        应用分发、匿名使用情况统计使用了 App Center 的服务。
                                                    </Paragraph>
                                                </ListItem>
                                                <ListItem>
                                                    <Paragraph>
                                                        天气数据来源于小米天气。
                                                    </Paragraph>
                                                </ListItem>
                                                <ListItem>
                                                    <Paragraph>
                                                        部分图像资源（/Assets/HoYoStickers/*）来自米游社和Bilibili装扮表情包，版权归 miHoYo 所有。
                                                    </Paragraph>
                                                </ListItem>
                                                <ListItem>
                                                    <Paragraph>
                                                        其他使用的第三方库和贡献成员，详见贡献名单和第三方库。
                                                    </Paragraph>
                                                </ListItem>
                                            </List>

                                            <Paragraph Foreground="#03f7d1ec">
                                                永远喜欢爱莉希雅
                                            </Paragraph>

                                        </FlowDocument>
                                    </FlowDocumentScrollViewer>
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>

                        <!-- 调试 -->
                        <TabItem Header="调试"
                                 Visibility="{Binding Settings.IsDebugOptionsEnabled, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <ScrollViewer>
                                <StackPanel Style="{StaticResource SettingsPageStackPanelStyle}" 
                                            Visibility="{Binding ManagementService.Policy.DisableDebugMenu, Converter={StaticResource InverseBoolToVisConverter}}">
                                    <StackPanel.Resources>
                                        <Style TargetType="MenuItem" BasedOn="{StaticResource MaterialDesignMenuItem}">
                                            <Style.Resources>
                                                <Style TargetType="materialDesign:PackIcon">
                                                    <Setter Property="Foreground"
                                                            Value="{DynamicResource PrimaryHueMidBrush}" />
                                                </Style>
                                            </Style.Resources>
                                        </Style>
                                    </StackPanel.Resources>
                                    <TextBlock Text="调试" Style="{StaticResource MaterialDesignHeadline5TextBlock}" />
                                    <TextBlock Margin="0 12" Foreground="IndianRed">
                                        <Run Text="仅供调试，除非你能知道您在做什么，请不要使用以下按钮。"></Run>
                                    </TextBlock>

                                    <MenuItem Icon="{materialDesign:PackIcon Close}"
                                              Header="关闭调试菜单"
                                              Click="ButtonCloseDebug_OnClick" />
                                    <Separator />
                                    <MenuItem Icon="{materialDesign:PackIcon LightningBoltOutline}"
                                              Header="FeatureDebugWindow"
                                              Click="MenuItemFeatureDebugWindow_OnClick"/>
                                    <MenuItem IsCheckable="True" Header="调试菜单"
                                              IsChecked="{Binding Settings.IsDebugEnabled}" />
                                    <MenuItem IsCheckable="True" Header="调试终端"
                                              IsChecked="{Binding Settings.IsDebugConsoleEnabled}"
                                              Checked="MenuItemDebugConsole_OnChecked"
                                              Unchecked="MenuItemDebugConsole_OnUnchecked" />
                                    <MenuItem IsCheckable="True" Header="MainWindowDebug"
                                              IsChecked="{Binding Settings.IsMainWindowDebugEnabled}" />
                                    <MenuItem Icon="{materialDesign:PackIcon Bomb}"
                                              Header="CrashTest"
                                              Click="ButtonCrash_OnClick" />
                                    <MenuItem Icon="{materialDesign:PackIcon Bomb}"
                                              Header="AppCenter Crash Test"
                                              Click="MenuItemDebugAppCenterCrashTest_OnClick" />
                                    <MenuItem Icon="{materialDesign:PackIcon Bomb}"
                                              Header="内存泄露100MB"
                                              Click="MenuItemMemoryLeakTest_OnClick" />
                                    <MenuItem Icon="{materialDesign:PackIcon MessageOutline}"
                                              Header="ToastMe!"
                                              Click="ButtonDebugToastText_OnClick" />
                                    <MenuItem Icon="{materialDesign:PackIcon ClockOutline}"
                                              Header="修改时间（相对）"
                                              Click="MenuItemDebugSetTime_OnClick"
                                              Command="{x:Static materialDesign:DialogHost.OpenDialogCommand}"
                                              CommandParameter="{StaticResource DebugSetTime}"/>
                                    <Separator />
                                    <MenuItem Icon="{materialDesign:PackIcon FlashOutline}" Header="触发下课"
                                              Click="MenuItemDebugTriggerAfterClass_OnClick" />
                                    <MenuItem Icon="{materialDesign:PackIcon FlashOutline}" Header="触发上课"
                                              Click="MenuItemDebugTriggerOnClass_OnClick" />
                                    <MenuItem Icon="{materialDesign:PackIcon WindowMaximize}" Header="测试Dialog"
                                              Click="MenuItemTestCommonDialog_OnClick" />
                                    <Separator />
                                    <!-- 动画缩放 -->
                                    <controls:SettingsControl IconGlyph="BugOutline" Header="(Debug)动画缩放"
                                                              Description="主界面动画播放倍速">
                                        <controls:SettingsControl.Switcher>
                                            <TextBox
                                                Text="{Binding Settings.DebugAnimationScale, Mode=TwoWay, Converter={StaticResource IntToStringConverter}}"
                                                MinWidth="150" />
                                        </controls:SettingsControl.Switcher>
                                    </controls:SettingsControl>
                                    <PasswordBox
                                        materialDesign:PasswordBoxAssist.Password="{Binding Settings.DebugGitHubAuthKey}"
                                        materialDesign:HintAssist.Hint="gh更新测试密钥"
                                        Style="{StaticResource MaterialDesignFloatingHintRevealPasswordBox}" />
                                    <Separator />
                                    <MenuItem Icon="{materialDesign:PackIcon MonitorScreenshot}" Header="测试桌面截图"
                                              Click="MenuItemDebugScreenShot_OnClick" />
                                    <Image Stretch="UniformToFill" Source="{Binding ViewModel.TestImage, Mode=OneWay}" />
                                    <ItemsControl ItemsSource="{Binding ViewModel.DebugImageAccentColors, Mode=TwoWay}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel IsItemsHost="True" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Rectangle Width="32" Height="32"
                                                           Fill="{Binding Converter={StaticResource ColorToColorPickerBrushConverter}}" />
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                    <TextBox Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             AcceptsReturn="True"
                                             Text="{Binding ViewModel.DebugOutputs}" />
                                    <Separator Margin="0 6" />
                                    <controls:StarRailLoadingControl Height="150"/>
                                    <controls:TeyvatLoadingControl />
                                    <controls:WeatherRangePackIconControl>
                                        <controls:WeatherRangePackIconControl.Value>
                                            <weather:RangedValue From="0" To="1" />
                                        </controls:WeatherRangePackIconControl.Value>
                                    </controls:WeatherRangePackIconControl>
                                    <controls:WeatherRangePackIconControl>
                                        <controls:WeatherRangePackIconControl.Value>
                                            <weather:RangedValue From="0" To="0" />
                                        </controls:WeatherRangePackIconControl.Value>
                                    </controls:WeatherRangePackIconControl>
                                    <controls:SplashControl />
                                    <MenuItem Icon="{materialDesign:PackIcon LightningBoltOutline}"
                                              Header="测试SplashWindow" Click="MenuItemDebugSplashWindow_OnClick" />
                                    <MenuItem Header="selected" x:Name="DebugWizardOptionControlSelected"
                                              IsCheckable="True" />
                                    <controls:WizardOptionControl OptionHeader="测试选项"
                                                                  OptionContent="{StaticResource TestStringLong}"
                                                                  IsSelected="{Binding IsChecked, ElementName=DebugWizardOptionControlSelected}" />

                                    <controls:WizardOptionsListBox PreviewMouseWheel="UIElement_OnPreviewMouseWheel">
                                        <models:WizardOption Header="111" Content="222" />
                                        <models:WizardOption Header="111" Content="222" />
                                    </controls:WizardOptionsListBox>
                                    <Separator Margin="0 6" />

                                    <MenuItem Icon="{materialDesign:PackIcon AnimationPlayOutline}" Header="测试天气滚动字幕"
                                              Click="MenuItemTestWeatherNotificationControl_OnClick" />
                                    <Border BorderBrush="{DynamicResource PrimaryHueMidBrush}"
                                            BorderThickness="1"
                                            Padding="8"
                                            CornerRadius="4">
                                        <ContentPresenter Content="{Binding ViewModel.WeatherNotificationControlTest}"
                                                          HorizontalAlignment="Stretch"
                                                          VerticalAlignment="Stretch"
                                                          Height="40"
                                                          ClipToBounds="True" />
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>
                        <TabItem Header="笔刷"
                                 Visibility="{Binding Settings.IsDebugOptionsEnabled, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <ScrollViewer>
                                <StackPanel Style="{StaticResource SettingsPageStackPanelStyle}"
                                            Visibility="{Binding ManagementService.Policy.DisableDebugMenu, Converter={StaticResource InverseBoolToVisConverter}}">
                                    <StackPanel.Resources>
                                        <Style TargetType="Border">
                                            <Setter Property="Padding" Value="6" />
                                        </Style>
                                    </StackPanel.Resources>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource SecondaryHueLightBrush}"
                                            ToolTip="SecondaryHueLightBrush">
                                        <TextBlock Text="SecondaryHueLightBrush" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource SecondaryHueLightForegroundBrush}"
                                            ToolTip="SecondaryHueLightForegroundBrush">
                                        <TextBlock Text="SecondaryHueLightForegroundBrush" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource SecondaryHueMidBrush}"
                                            ToolTip="SecondaryHueMidBrush">
                                        <TextBlock Text="SecondaryHueMidBrush" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource SecondaryHueMidForegroundBrush}"
                                            ToolTip="SecondaryHueMidForegroundBrush">
                                        <TextBlock Text="SecondaryHueMidForegroundBrush" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource SecondaryHueDarkBrush}"
                                            ToolTip="SecondaryHueDarkBrush">
                                        <TextBlock Text="SecondaryHueDarkBrush" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource SecondaryHueDarkForegroundBrush}"
                                            ToolTip="SecondaryHueDarkForegroundBrush">
                                        <TextBlock Text="SecondaryHueDarkForegroundBrush" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource PrimaryHueLightBrush}"
                                            ToolTip="PrimaryHueLightBrush">
                                        <TextBlock Text="PrimaryHueLightBrush" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource PrimaryHueLightForegroundBrush}"
                                            ToolTip="PrimaryHueLightForegroundBrush">
                                        <TextBlock Text="PrimaryHueLightForegroundBrush" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource PrimaryHueMidBrush}"
                                            ToolTip="PrimaryHueMidBrush">
                                        <TextBlock Text="PrimaryHueMidBrush" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource PrimaryHueMidForegroundBrush}"
                                            ToolTip="PrimaryHueMidForegroundBrush">
                                        <TextBlock Text="PrimaryHueMidForegroundBrush" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource PrimaryHueDarkBrush}"
                                            ToolTip="PrimaryHueDarkBrush">
                                        <TextBlock Text="PrimaryHueDarkBrush" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource PrimaryHueDarkForegroundBrush}"
                                            ToolTip="PrimaryHueDarkForegroundBrush">
                                        <TextBlock Text="PrimaryHueDarkForegroundBrush" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignBackground}"
                                            ToolTip="MaterialDesignBackground">
                                        <TextBlock Text="MaterialDesignBackground" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignPaper}"
                                            ToolTip="MaterialDesignPaper">
                                        <TextBlock Text="MaterialDesignPaper" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignCardBackground}"
                                            ToolTip="MaterialDesignCardBackground">
                                        <TextBlock Text="MaterialDesignCardBackground" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignToolBarBackground}"
                                            ToolTip="MaterialDesignToolBarBackground">
                                        <TextBlock Text="MaterialDesignToolBarBackground" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignBody}"
                                            ToolTip="MaterialDesignBody">
                                        <TextBlock Text="MaterialDesignBody" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignBodyLight}"
                                            ToolTip="MaterialDesignBodyLight">
                                        <TextBlock Text="MaterialDesignBodyLight" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignColumnHeader}"
                                            ToolTip="MaterialDesignColumnHeader">
                                        <TextBlock Text="MaterialDesignColumnHeader" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignCheckBoxOff}"
                                            ToolTip="MaterialDesignCheckBoxOff">
                                        <TextBlock Text="MaterialDesignCheckBoxOff" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignCheckBoxDisabled}"
                                            ToolTip="MaterialDesignCheckBoxDisabled">
                                        <TextBlock Text="MaterialDesignCheckBoxDisabled" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignTextBoxBorder}"
                                            ToolTip="MaterialDesignTextBoxBorder">
                                        <TextBlock Text="MaterialDesignTextBoxBorder" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignDivider}"
                                            ToolTip="MaterialDesignDivider">
                                        <TextBlock Text="MaterialDesignDivider" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignSelection}"
                                            ToolTip="MaterialDesignSelection">
                                        <TextBlock Text="MaterialDesignSelection" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignFlatButtonClick}"
                                            ToolTip="MaterialDesignFlatButtonClick">
                                        <TextBlock Text="MaterialDesignFlatButtonClick" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignFlatButtonRipple}"
                                            ToolTip="MaterialDesignFlatButtonRipple">
                                        <TextBlock Text="MaterialDesignFlatButtonRipple" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignToolTipBackground}"
                                            ToolTip="MaterialDesignToolTipBackground">
                                        <TextBlock Text="MaterialDesignToolTipBackground" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignChipBackground}"
                                            ToolTip="MaterialDesignChipBackground">
                                        <TextBlock Text="MaterialDesignChipBackground" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignSnackbarBackground}"
                                            ToolTip="MaterialDesignSnackbarBackground">
                                        <TextBlock Text="MaterialDesignSnackbarBackground" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignSnackbarMouseOver}"
                                            ToolTip="MaterialDesignSnackbarMouseOver">
                                        <TextBlock Text="MaterialDesignSnackbarMouseOver" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignSnackbarRipple}"
                                            ToolTip="MaterialDesignSnackbarRipple">
                                        <TextBlock Text="MaterialDesignSnackbarRipple" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignTextFieldBoxBackground}"
                                            ToolTip="MaterialDesignTextFieldBoxBackground">
                                        <TextBlock Text="MaterialDesignTextFieldBoxBackground" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignTextFieldBoxHoverBackground}"
                                            ToolTip="MaterialDesignTextFieldBoxHoverBackground">
                                        <TextBlock Text="MaterialDesignTextFieldBoxHoverBackground" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignTextFieldBoxDisabledBackground}"
                                            ToolTip="MaterialDesignTextFieldBoxDisabledBackground">
                                        <TextBlock Text="MaterialDesignTextFieldBoxDisabledBackground" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignTextAreaBorder}"
                                            ToolTip="MaterialDesignTextAreaBorder">
                                        <TextBlock Text="MaterialDesignTextAreaBorder" />
                                    </Border>
                                    <Border HorizontalAlignment="Stretch"
                                            Background="{DynamicResource MaterialDesignTextAreaInactiveBorder}"
                                            ToolTip="MaterialDesignTextAreaInactiveBorder">
                                        <TextBlock Text="MaterialDesignTextAreaInactiveBorder" />
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>
                    </TabControl>
                    <materialDesign:ColorZone Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="0" Padding="16"
                                              Mode="PrimaryMid"
                                              materialDesign:ElevationAssist.Elevation="Dp4"
                                              Margin="0 0 0 4">
                        <Grid Margin="4 0 4 0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <!--<ToggleButton Grid.Column="0"
                            Style="{StaticResource MaterialDesignHamburgerToggleButton}" />-->
                            <!--<Button ToolTip="导航栏"
                                VerticalAlignment="Center"
                                Padding="0"
                                Style="{StaticResource MaterialDesignToolForegroundButton}"
                                Content="{materialDesign:PackIcon Menu, Size=24}"/>-->

                            <StackPanel Orientation="Horizontal" Grid.Column="0">

                                <TextBlock Text="应用设置"
                                           Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                           HorizontalAlignment="Left"
                                           Margin="0 0 0 0"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                                <StackPanel.Resources>
                                    <Style TargetType="materialDesign:Chip"
                                           BasedOn="{StaticResource MaterialDesignOutlineChip}">
                                        <Style.Resources>
                                            <converters:SolidColorBrushOpacityConverter
                                                x:Key="SolidColorBrushOpacityConverter" />
                                        </Style.Resources>
                                        <Setter Property="Foreground"
                                                Value="{Binding RelativeSource={RelativeSource AncestorType={x:Type FrameworkElement}}, Path=(TextElement.Foreground)}" />
                                        <Setter Property="BorderBrush"
                                                Value="{Binding RelativeSource={RelativeSource AncestorType={x:Type FrameworkElement}}, Path=(TextElement.Foreground), Converter={StaticResource SolidColorBrushOpacityConverter}, ConverterParameter=0.5, Mode=OneWay}" />
                                        <Setter Property="IconForeground" Value="{DynamicResource MaterialDesignBody}" />
                                        <Setter Property="IconBackground"
                                                Value="{Binding RelativeSource={RelativeSource AncestorType={x:Type FrameworkElement}}, Path=(TextElement.Foreground), Converter={StaticResource SolidColorBrushOpacityConverter}, ConverterParameter=0.5, Mode=OneWay}" />
                                        <Setter Property="Margin" Value="0 -8 6 -8" />
                                    </Style>
                                </StackPanel.Resources>
                                <materialDesign:Chip
                                    Visibility="{Binding ViewModel.IsRestartRequired, Converter={StaticResource BooleanToVisibilityConverter}}"
                                    Click="ButtonRestartChip_OnClick"
                                    ToolTip="部分设置需要重启以应用"
                                    Icon="{materialDesign:PackIcon Restart}">
                                    <TextBlock>
                                        <Run Text="需要重启" />
                                    </TextBlock>
                                </materialDesign:Chip>
                                <materialDesign:Chip
                                    Visibility="{Binding ManagementService.IsManagementEnabled, Converter={StaticResource BooleanToVisibilityConverter}}"
                                    Command="{x:Static materialDesign:DialogHost.OpenDialogCommand}"
                                    ToolTip="查看您的单位/组织如何管理此ClassIsland实例。"
                                    Icon="{materialDesign:PackIcon WorkOutline}">
                                    <materialDesign:Chip.CommandParameter>
                                        <controls:ManagementInfoControl />
                                    </materialDesign:Chip.CommandParameter>
                                    <TextBlock>
                                        <Run Text="由贵单位管理" />
                                    </TextBlock>
                                </materialDesign:Chip>
                                <TextBlock Text="{x:Static ci:App.AppVersion}"
                                           Margin="8 0 0 0"
                                           VerticalAlignment="Center"
                                           ToolTip="应用版本" />
                                <materialDesign:PopupBox Margin="8 0 -8 0" ToolTip="更多选项…" StaysOpen="False"
                                                         IsPopupOpen="{Binding ViewModel.IsPopupMenuOpened, Mode=TwoWay}">
                                    <StackPanel>
                                        <!--<MenuItem Icon="{materialDesign:PackIcon WarningCircleOutline}" Header="查看崩溃报告…"/>
                                        <Separator/>-->
                                        <MenuItem Icon="{materialDesign:PackIcon Code}" Header="实验性功能…"
                                                  Click="MenuItemExperimentalSettings_OnClick" />
                                        <MenuItem Icon="{materialDesign:PackIcon WorkOutline}" Header="加入管理…"
                                                  Click="MenuItemConnetManagemnt_OnClick" 
                                                  Visibility="{Binding ManagementService.IsManagementEnabled, Converter={StaticResource InverseBoolToVisConverter}}"
                                                  Command="{x:Static materialDesign:DialogHost.OpenDialogCommand}">
                                            <MenuItem.CommandParameter>
                                                <controls:JoinManagementDialog/>
                                            </MenuItem.CommandParameter>
                                        </MenuItem>
                                        <MenuItem Icon="{materialDesign:PackIcon WorkOutline}" Header="退出管理…"
                                                  Click="MenuItemExitManagement_OnClick" 
                                                  Visibility="{Binding ManagementService.IsManagementEnabled, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        </MenuItem>
                                        <Separator/>
                                        <MenuItem Icon="{materialDesign:PackIcon FileDocumentOutline}"
                                                  Header="日志…"
                                                  Click="MenuItemAppLogs_OnClick"/>
                                        <MenuItem Icon="{materialDesign:PackIcon DatabaseExportOutline}"
                                                  Header="导出诊断数据"
                                                  Click="MenuItemExportDiagnosticInfo_OnClick"/>
                                    </StackPanel>
                                </materialDesign:PopupBox>
                            </StackPanel>
                        </Grid>
                    </materialDesign:ColorZone>
                </Grid>
            </materialDesign:DrawerHost>
        </materialDesign:DialogHost>
        <windows:AsyncBox VerticalAlignment="Bottom" Height="8" LoadingViewType="controls:LoadingMask" />
    </Grid>
</controls:MyWindow>