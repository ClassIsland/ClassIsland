<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls1="using:ClassIsland.Controls.EditMode"
        xmlns:ci="http://classisland.tech/schemas/xaml/core"
        xmlns:components="clr-namespace:ClassIsland.Core.Models.Components;assembly=ClassIsland.Core"
        xmlns:controls="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia">
    <Design.PreviewWith>
        <controls1:EditableComponentsListBox />
    </Design.PreviewWith>

    <Style Selector="controls1|EditableComponentsListBox" >
        <!-- Set Defaults -->
        <Style.Resources>
            <controls1:EditableComponentsListBoxDropHandler x:Key="DropHandler"/>
            <DataTemplate x:DataType="controls1:EditableComponentsListBoxDragData"
                          x:Key="ComponentSettingsPreviewEffect">
                <Border Background="{DynamicResource AcrylicBackgroundFillColorDefaultBrush}"
                        CornerRadius="6"
                        Padding="4"
                        BorderBrush="{DynamicResource SurfaceStrokeColorDefaultBrush}"
                        BorderThickness="1">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <controls:IconSourceElement IconSource="{Binding ComponentSettings.AssociatedComponentInfo.IconSource}"
                                                    VerticalAlignment="Center" Height="16" Width="16"
                                                    ClipToBounds="False"
                                                    TextElement.FontSize="16"
                                                    Classes="repair-fontsize"/>
                        <TextBlock Text="{Binding ComponentSettings.AssociatedComponentInfo.Name}"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                </Border>
            </DataTemplate>
        </Style.Resources>
        <Setter Property="ItemsSourceInternal" Value="{Binding $self.ItemsSource}"/>
        <Setter Property="ItemsPanel">
            <ItemsPanelTemplate>
                <StackPanel Classes="components-panel edit-mode-panel"/>
            </ItemsPanelTemplate>
        </Setter>
        <Setter Property="ClipToBounds" Value="False"/>
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="Template">
            <ControlTemplate TargetType="controls1:EditableComponentsListBox">
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <ItemsPresenter ItemsPanel="{TemplateBinding ItemsPanel}"/>
                    <Button Height="32"
                            IsVisible="{Binding $self.(ci:MainWindowStylesAssist.MainWindowInEditMode)}"
                            Content="{ci:FluentIcon &#xE00D;, FontSize=20}">
                    </Button>
                </StackPanel>
            </ControlTemplate>
        </Setter>
        <Setter Property="ItemContainerTheme">
            <ControlTheme TargetType="ListBoxItem">
                <Setter Property="controls1:EditableComponentsListBox.IsEditableComponentsListBoxChild" Value="True"/>
                <Setter Property="Tag" Value="edit-mode-drop-target"/>
                <Setter Property="Padding" Value="0"/>
                <Setter Property="MaxHeight" Value="{DynamicResource IslandContainerHeight}"/>
                <Setter Property="MinWidth" Value="0"/>
                <Setter Property="VerticalContentAlignment" Value="Stretch"/>
                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                <Setter Property="ClipToBounds" Value="False"/>
                <Setter Property="Template" >
                    <ControlTemplate>
                        <Panel>
                            <Panel.Styles>
                                <Style Selector="TextBlock">
                                    <Setter Property="Margin" Value="0"/>
                                </Style>
                                <Style Selector="AccessText">
                                    <Setter Property="Margin" Value="0"/>
                                </Style>
                            </Panel.Styles>
                            <ContentPresenter Name="PART_ContentPresenter"
                                              Background="{TemplateBinding Background}"
                                              BorderBrush="{TemplateBinding BorderBrush}"
                                              BorderThickness="{TemplateBinding BorderThickness}"
                                              ContentTemplate="{TemplateBinding ContentTemplate}"
                                              Content="{TemplateBinding Content}"
                                              Padding="0"
                                              ClipToBounds="False"
                                              VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                                              HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              CornerRadius="{TemplateBinding CornerRadius}"
                                              Margin="0"
                                              IsHitTestVisible="False"/>
                        </Panel>
                    </ControlTemplate>
                </Setter>
                
                <Style Selector="^[(ci|MainWindowStylesAssist.MainWindowInEditMode)=True]">
                    <Setter Property="Template" >
                        <ControlTemplate>
                            <Panel>
                                <Panel.Styles>
                                    <Style Selector="TextBlock">
                                        <Setter Property="Margin" Value="0"/>
                                    </Style>
                                    <Style Selector="AccessText">
                                        <Setter Property="Margin" Value="0"/>
                                    </Style>
                                </Panel.Styles>
                                <Border HorizontalAlignment="Stretch"
                                        VerticalAlignment="Stretch"
                                        Background="Transparent"/>
                                <ContentPresenter Name="PART_ContentPresenter"
                                                  Background="{TemplateBinding Background}"
                                                  BorderBrush="{TemplateBinding BorderBrush}"
                                                  BorderThickness="{TemplateBinding BorderThickness}"
                                                  ContentTemplate="{TemplateBinding ContentTemplate}"
                                                  Content="{TemplateBinding Content}"
                                                  Padding="0"
                                                  ClipToBounds="False"
                                                  VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                                                  HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  CornerRadius="{TemplateBinding CornerRadius}"
                                                  Margin="0"
                                                  IsHitTestVisible="False"/>
                                <Thumb HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                                    <Thumb.Template>
                                        <ControlTemplate>
                                            <Border Background="Transparent"
                                                    HorizontalAlignment="Stretch"
                                                    VerticalAlignment="Stretch"/>
                                        </ControlTemplate>
                                    </Thumb.Template>
                                </Thumb>
                            </Panel>
                        </ControlTemplate>
                    </Setter>
                </Style>
            </ControlTheme>
        </Setter>
        <Setter Property="(Interaction.Behaviors)">
            <BehaviorCollectionTemplate>
                <BehaviorCollection>
                    <ManagedContextDropBehavior OverClass="TargetHighlight" 
                                                Handler="{StaticResource DropHandler}"
                                                Context="{Binding ItemsSource, RelativeSource={RelativeSource TemplatedParent}}"/>
                </BehaviorCollection>
            </BehaviorCollectionTemplate>
        </Setter>
        
        <Style Selector="^ ListBoxItem[(controls1|EditableComponentsListBox.IsEditableComponentsListBoxChild)=True]">
            <Setter Property="(Interaction.Behaviors)">
                <BehaviorCollectionTemplate>
                    <BehaviorCollection>
                        <ci:AdvancedManagedContextDragBehavior HorizontalDragThreshold="3"
                                                    VerticalDragThreshold="3"
                                                    PreviewOpacity="0.75"
                                                    PreviewTemplate="{StaticResource ComponentSettingsPreviewEffect}"
                                                    UsePointerRelativePreviewOffset="True">
                            <ci:AdvancedManagedContextDragBehavior.Context>
                                <controls1:EditableComponentsListBoxDragData
                                    x:CompileBindings="True"
                                    x:DataType="components:ComponentSettings"
                                    ComponentSettings="{Binding}"
                                    SourceList="{Binding $parent[ListBoxItem].(controls1:EditableComponentsListBox.ItemsSourceInternal)}"/>
                            </ci:AdvancedManagedContextDragBehavior.Context>
                        </ci:AdvancedManagedContextDragBehavior>
                        <ManagedContextDropBehavior OverClass="TargetHighlight"
                                                    x:DataType="components:ComponentSettings"
                                                    x:CompileBindings="True"
                                                    Handler="{StaticResource DropHandler}"
                                                    Context="{Binding $parent[ListBoxItem].(controls1:EditableComponentsListBox.ItemsSourceInternal)}"/>
                    </BehaviorCollection>
                </BehaviorCollectionTemplate>
            </Setter>
        </Style>
        
        
    </Style>
</Styles>
