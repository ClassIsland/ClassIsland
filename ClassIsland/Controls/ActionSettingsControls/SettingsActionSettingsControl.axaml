<ci:ActionSettingsControlBase x:Name="This"
                              x:Class="ClassIsland.Controls.ActionSettingsControls.SettingsActionSettingsControl"
                              x:TypeArguments="actionSettings:SettingsActionSettings"
                              d:DataContext="{d:DesignInstance Type=local:SettingsActionSettingsControl}"
                              xmlns="https://github.com/avaloniaui"
                              xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                              xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                              xmlns:ci="http://classisland.tech/schemas/xaml/core"
                              xmlns:fa="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia"
                              xmlns:local="clr-namespace:ClassIsland.Controls.ActionSettingsControls"
                              xmlns:actionSettings="clr-namespace:ClassIsland.Models.Actions"
                              xmlns:converters="clr-namespace:ClassIsland.Converters">
    <ci:ActionSettingsControlBase.Resources>
        <Panel x:Key="SettingsActionSettingsDrawer"
               d:DataContext="{d:DesignInstance local:SettingsActionSettingsControl}"
               Width="400">
            <Grid Classes="animated-intro"
                  RowDefinitions="Auto Auto *">
                <TextBlock Margin="0 0 0 8"
                           Text="选择应用设置"
                           Theme="{StaticResource SubtitleTextBlockStyle}" />
                <TextBox x:Name="SearchSettingsTextBox"
                         Grid.Row="1"
                         TextChanged="SearchSettingsTextBox_OnTextChanged"
                         Watermark="搜索应用设置…" />
                <!--  Main list box  -->
                <ListBox Grid.Row="2"
                         Margin="0 8 0 0"
                         AutoScrollToSelectedItem="True"
                         ItemsSource="{Binding ViewModel.SettingsSearchResults}"
                         SelectedValue="{Binding Settings.Name, Converter={StaticResource PreventNullConverter}}"
                         SelectedValueBinding="{Binding Name}"
                         SelectionMode="Single">
                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <VirtualizingStackPanel Classes="animated-intro" />
                        </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <DockPanel LastChildFill="False">
                                <RadioButton IsChecked="{Binding IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType=ListBoxItem}}"
                                             Tag="{Binding Info, Converter={x:Static ObjectConverters.IsNull}}">
                                    <RadioButton.Styles>
                                        <Style Selector="RadioButton">
                                            <Style Selector="^[Tag=True]">
                                                <Setter Property="Content" Value="{Binding Name}" />
                                            </Style>
                                            <Style Selector="^[Tag=False]">
                                                <Setter Property="Content" Value="{Binding Info.Name}" />
                                            </Style>
                                        </Style>
                                    </RadioButton.Styles>
                                </RadioButton>

                                <TextBlock x:Name="ValueTextBlock"
                                           Margin="4 0 0 0"
                                           VerticalAlignment="Center"
                                           Text="{Binding Value}"
                                           DockPanel.Dock="Right"
                                           Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                                           ToolTip.Tip="{Binding Value}" />

                            </DockPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
                <!--  无结果  -->
                <StackPanel Grid.Row="2"
                            Margin="0 50"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            IsVisible="{Binding !!!ViewModel.SettingsSearchResults.Count}">
                    <ci:Empty Text="找不到应用设置。" />
                </StackPanel>
            </Grid>
        </Panel>
        <converters:ColorStringToAvaloniaColorConverter x:Key="ColorStringToAvaloniaColorConverter" />
    </ci:ActionSettingsControlBase.Resources>

    <Grid ColumnDefinitions="* Auto *">
        <ci:Field Label="应用设置名称">
            <Panel>
                <TextBox x:Name="PropertyNameTextBox"
                         Padding="{Binding ElementName=FileSelectorButton, Path=Bounds.Width, Converter={x:Static ci:AnimatedIconButton.TextBlockPaddingFuncConverter}}"
                         Text="{Binding Settings.Name, Mode=TwoWay}"
                         TextChanged="PropertyNameTextBox_OnTextChanged"
                         Watermark="应用设置名称" />
                <ci:AnimatedIconButton x:Name="FileSelectorButton"
                                       HorizontalAlignment="Right"
                                       VerticalAlignment="Stretch"
                                       VerticalContentAlignment="Center"
                                       Glyph="&#xEEF6;"
                                       Text="选择…"
                                       Click="FileSelectorButton_OnClick"
                                       Theme="{StaticResource TransparentButton}"
                                       ToolTip.Tip="选择应用设置…" />
            </Panel>
        </ci:Field>
        <ci:FluentIcon Grid.Column="1"
                       Margin="5 20 5 0"
                       VerticalAlignment="Center"
                       Glyph="&#xE130;" />

        <Panel Grid.Column="2">
            <ci:Field Label="设置值">
                <Grid ColumnDefinitions="* Auto">
                    <ContentPresenter x:Name="SettingsActionKindContentPresenter">
                        <ContentPresenter.ContentTemplate>
                            <local:SettingsActionKindTemplateSelector Kind="{Binding #This.ViewModel.Kind}">
                                <DataTemplate x:Key="int">
                                    <NumericUpDown FormatString="0"
                                                   Watermark="{Binding #This.ViewModel.Pack.Value, FallbackValue=（空）, StringFormat=当前值：{0}}"
                                                   Value="{Binding Settings.Value}" />
                                </DataTemplate>
                                <DataTemplate x:Key="double">
                                    <NumericUpDown Watermark="{Binding #This.ViewModel.Pack.Value, FallbackValue=（空）, StringFormat=当前值：{0}}"
                                                   Value="{Binding Settings.Value}" />
                                </DataTemplate>
                                <DataTemplate x:Key="bool">
                                    <ToggleSwitch Margin="5 -6 0 0"
                                                  VerticalAlignment="Top"
                                                  IsChecked="{Binding Settings.Value}" />
                                </DataTemplate>
                                <DataTemplate x:Key="color">
                                    <fa:ColorPickerButton VerticalAlignment="Center"
                                                          Color="{Binding Settings.Value, Mode=TwoWay, Converter={StaticResource ColorStringToAvaloniaColorConverter}}" />
                                </DataTemplate>
                                <DataTemplate x:Key="enums">
                                    <ComboBox ItemsSource="{Binding #This.ViewModel.Pack.Info.Enums}"
                                              SelectedIndex="{Binding Settings.Value, Converter={StaticResource PreventNullConverter}}" />
                                </DataTemplate>
                                <DataTemplate x:Key="normal">
                                    <TextBox VerticalAlignment="Center"
                                             Text="{Binding Settings.Value}"
                                             Watermark="{Binding #This.ViewModel.Pack.Value, FallbackValue=（空）, StringFormat=当前值：{0}}" />
                                </DataTemplate>
                            </local:SettingsActionKindTemplateSelector>
                        </ContentPresenter.ContentTemplate>
                    </ContentPresenter>

                    <Panel Grid.Column="1">
                        <ci:AnimatedIconButton x:Name="FillCurrentValueButton"
                                               HorizontalAlignment="Right"
                                               VerticalAlignment="Stretch"
                                               VerticalContentAlignment="Center"
                                               Glyph="&#xEAD4;"
                                               Text="当前值"
                                               Click="FillCurrentValueButton_OnClick"
                                               Theme="{StaticResource TransparentButton}"
                                               ToolTip.ShowDelay="0"
                                               ToolTip.Tip="{Binding #This.ViewModel.Pack.Value}" />
                    </Panel>
                </Grid>
            </ci:Field>
        </Panel>
    </Grid>
</ci:ActionSettingsControlBase>